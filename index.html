<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Cache Control Meta Tags - Version 2.0 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="version" content="2.0">
  <title>Learning Galaxy - Grade 3-4 Games v2.0</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body,
    #root {
      height: 100%;
      width: 100%;
      overflow-x: hidden;
    }

    /* Android Chrome fixes */
    body {
      -webkit-overflow-scrolling: touch;
      overflow-y: auto;
      position: relative;
    }

    button,
    input,
    textarea,
    select {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    input,
    textarea {
      -webkit-user-select: text;
      user-select: text;
    }

    @keyframes twinkle {

      0%,
      100% {
        opacity: 0.3;
      }

      50% {
        opacity: 1;
      }
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes rocketLaunch {
      0% {
        transform: translate(-50%, 0);
      }

      100% {
        transform: translate(-50%, -100px);
        opacity: 0;
      }
    }

    @keyframes alienFloat {

      0%,
      100% {
        transform: translateY(0) rotate(-5deg);
      }

      50% {
        transform: translateY(-15px) rotate(5deg);
      }
    }

    @keyframes bubbleFloat {

      0%,
      100% {
        transform: translateY(0) scale(1);
      }

      50% {
        transform: translateY(-12px) scale(1.05);
      }
    }

    @keyframes planetOrbit {
      0% {
        transform: rotate(0deg) translateX(10px) rotate(0deg);
      }

      100% {
        transform: rotate(360deg) translateX(10px) rotate(-360deg);
      }
    }

    @keyframes coinSpin {
      0% {
        transform: rotateY(0deg);
      }

      100% {
        transform: rotateY(360deg);
      }
    }

    @keyframes starTwinkle {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.5;
        transform: scale(0.8);
      }
    }

    @keyframes asteroidMove {
      0% {
        transform: translateX(-20px) rotate(0deg);
      }

      50% {
        transform: translateX(20px) rotate(180deg);
      }

      100% {
        transform: translateX(-20px) rotate(360deg);
      }
    }

    @keyframes portalPulse {

      0%,
      100% {
        box-shadow: 0 0 20px currentColor;
      }

      50% {
        box-shadow: 0 0 40px currentColor, 0 0 60px currentColor;
      }
    }

    @keyframes bookGlow {

      0%,
      100% {
        filter: drop-shadow(0 0 10px rgba(255, 200, 100, 0.5));
      }

      50% {
        filter: drop-shadow(0 0 20px rgba(255, 200, 100, 0.8));
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ============ MOBILE-COMPATIBLE STORAGE ============
    const storage = {
      get: async (key) => {
        try {
          if (window.storage?.get) return await window.storage.get(key);
          const value = localStorage.getItem(key);
          return value ? { value } : null;
        } catch (e) { return null; }
      },
      set: async (key, value) => {
        try {
          if (window.storage?.set) return await window.storage.set(key, value);
          localStorage.setItem(key, value);
        } catch (e) { }
      }
    };

    // ============ GOOGLE SHEETS CONFIG ============
    const DEFAULT_SETTINGS = {
      mathSheetUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQr3nlml1JTPMR4ROfCKarFSayMFxYyOwZO-v_A0INlG1oMloM5wm0wltURipcy0A/pub?output=csv',
      englishSheetUrl: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRses_Y74IwZ6nFvmwMygKruq0HgQZZmOEYSdf3sE0pInXXByyU0uSf8KPY8Z6Giw/pub?output=csv',
      topicSheetUrl: '',
      selectedTopics: '',
      selectedSubtopics: '',
      selectedMathWorksheet: '1',
      selectedEnglishWorksheet: '1',
      defaultDifficulty: 'None',
      soundEnabled: true,
      leaderboardUrl: '',
      settingsSheetUrl: ''
    };

    // ============ CSV PARSER ============
    const parseCSV = (csv) => {
      const lines = csv.split('\n').filter(line => line.trim());
      if (lines.length < 2) return [];
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/['"]/g, ''));
      return lines.slice(1).map(line => {
        const values = [];
        let current = '';
        let inQuotes = false;
        for (let char of line) {
          if (char === '"') inQuotes = !inQuotes;
          else if (char === ',' && !inQuotes) { values.push(current.trim()); current = ''; }
          else current += char;
        }
        values.push(current.trim());
        const obj = {};
        headers.forEach((h, i) => { obj[h] = values[i] || ''; });
        return obj;
      });
    };

    // ============ FALLBACK DATA FOR OFFLINE/FILE PROTOCOL ============
    const FALLBACK_MATH_DATA = [
      // Space Math - Easy
      { game_type: 'space-math', num1: '5', num2: '3', operation: '+', answer: '8', option1: '8', option2: '7', option3: '9', option4: '6', difficulty: 'Easy', know_more: 'Addition means combining numbers together! 5 + 3 = 8' },
      { game_type: 'space-math', num1: '12', num2: '7', operation: '+', answer: '19', option1: '19', option2: '18', option3: '20', option4: '17', difficulty: 'Easy', know_more: 'When adding, count up from the bigger number!' },
      { game_type: 'space-math', num1: '8', num2: '4', operation: '-', answer: '4', option1: '4', option2: '3', option3: '5', option4: '6', difficulty: 'Easy', know_more: 'Subtraction means taking away. 8 - 4 = 4' },
      { game_type: 'space-math', num1: '9', num2: '9', operation: '+', answer: '18', option1: '18', option2: '16', option3: '19', option4: '17', difficulty: 'Easy', know_more: 'Doubles are easy! 9 + 9 = 18' },
      { game_type: 'space-math', num1: '15', num2: '6', operation: '-', answer: '9', option1: '9', option2: '8', option3: '10', option4: '7', difficulty: 'Easy', know_more: 'Count backwards from 15 six times!' },
      // Space Math - Medium
      { game_type: 'space-math', num1: '6', num2: '7', operation: '×', answer: '42', option1: '42', option2: '36', option3: '48', option4: '35', difficulty: 'Medium', know_more: 'Multiplication is repeated addition! 6 × 7 = 42' },
      { game_type: 'space-math', num1: '8', num2: '4', operation: '×', answer: '32', option1: '32', option2: '28', option3: '36', option4: '24', difficulty: 'Medium', know_more: '8 groups of 4 equals 32!' },
      { game_type: 'space-math', num1: '45', num2: '18', operation: '+', answer: '63', option1: '63', option2: '60', option3: '65', option4: '58', difficulty: 'Medium', know_more: 'Add ones first then tens!' },
      { game_type: 'space-math', num1: '9', num2: '6', operation: '×', answer: '54', option1: '54', option2: '56', option3: '48', option4: '63', difficulty: 'Medium', know_more: '9 × 6 = 54!' },
      { game_type: 'space-math', num1: '72', num2: '35', operation: '-', answer: '37', option1: '37', option2: '47', option3: '27', option4: '43', difficulty: 'Medium', know_more: 'Subtract the ones then tens!' },
      // Space Math - Hard
      { game_type: 'space-math', num1: '12', num2: '11', operation: '×', answer: '132', option1: '132', option2: '122', option3: '144', option4: '121', difficulty: 'Hard', know_more: '12 × 11 = 132. Try 12 × 10 + 12!' },
      { game_type: 'space-math', num1: '156', num2: '78', operation: '+', answer: '234', option1: '234', option2: '224', option3: '244', option4: '214', difficulty: 'Hard', know_more: 'Add place by place!' },
      { game_type: 'space-math', num1: '144', num2: '12', operation: '÷', answer: '12', option1: '12', option2: '11', option3: '13', option4: '14', difficulty: 'Hard', know_more: '144 ÷ 12 = 12. Division is reverse multiplication!' },
      { game_type: 'space-math', num1: '15', num2: '15', operation: '×', answer: '225', option1: '225', option2: '215', option3: '235', option4: '200', difficulty: 'Hard', know_more: '15 squared = 225!' },
      { game_type: 'space-math', num1: '200', num2: '87', operation: '-', answer: '113', option1: '113', option2: '123', option3: '103', option4: '127', difficulty: 'Hard', know_more: 'Borrowing: 200 - 87 = 113!' },

      // Alien Invasion - Easy
      { game_type: 'alien-invasion', num1: '7', num2: '3', operation: '-', answer: '4', option1: '4', option2: '3', option3: '5', option4: '6', difficulty: 'Easy', know_more: 'Quick subtraction: 7 - 3 = 4' },
      { game_type: 'alien-invasion', num1: '3', num2: '2', operation: '+', answer: '5', option1: '5', option2: '4', option3: '6', option4: '7', difficulty: 'Easy', know_more: '3 aliens plus 2 aliens equals 5 aliens!' },
      { game_type: 'alien-invasion', num1: '10', num2: '4', operation: '-', answer: '6', option1: '6', option2: '5', option3: '7', option4: '4', difficulty: 'Easy', know_more: 'Ten minus 4 leaves 6!' },
      { game_type: 'alien-invasion', num1: '6', num2: '3', operation: '+', answer: '9', option1: '9', option2: '8', option3: '10', option4: '7', difficulty: 'Easy', know_more: '6 plus 3 is 9!' },
      { game_type: 'alien-invasion', num1: '4', num2: '5', operation: '+', answer: '9', option1: '9', option2: '8', option3: '7', option4: '10', difficulty: 'Easy', know_more: '5 plus 4 is also 9!' },
      // Alien Invasion - Medium
      { game_type: 'alien-invasion', num1: '5', num2: '4', operation: '×', answer: '20', option1: '20', option2: '16', option3: '24', option4: '25', difficulty: 'Medium', know_more: '5 × 4 = 20!' },
      { game_type: 'alien-invasion', num1: '6', num2: '6', operation: '×', answer: '36', option1: '36', option2: '30', option3: '42', option4: '32', difficulty: 'Medium', know_more: '6 squared is 36!' },
      { game_type: 'alien-invasion', num1: '7', num2: '8', operation: '×', answer: '56', option1: '56', option2: '54', option3: '48', option4: '64', difficulty: 'Medium', know_more: '7 × 8 = 56!' },
      { game_type: 'alien-invasion', num1: '9', num2: '4', operation: '×', answer: '36', option1: '36', option2: '32', option3: '40', option4: '45', difficulty: 'Medium', know_more: '9 × 4 = 36!' },
      { game_type: 'alien-invasion', num1: '8', num2: '7', operation: '×', answer: '56', option1: '56', option2: '63', option3: '49', option4: '64', difficulty: 'Medium', know_more: '8 × 7 = 56!' },
      // Alien Invasion - Hard
      { game_type: 'alien-invasion', num1: '12', num2: '12', operation: '×', answer: '144', option1: '144', option2: '132', option3: '156', option4: '121', difficulty: 'Hard', know_more: '12 × 12 = 144!' },
      { game_type: 'alien-invasion', num1: '81', num2: '9', operation: '÷', answer: '9', option1: '9', option2: '8', option3: '7', option4: '10', difficulty: 'Hard', know_more: '81 ÷ 9 = 9!' },
      { game_type: 'alien-invasion', num1: '13', num2: '7', operation: '×', answer: '91', option1: '91', option2: '84', option3: '98', option4: '77', difficulty: 'Hard', know_more: '13 × 7 = 91!' },
      { game_type: 'alien-invasion', num1: '64', num2: '8', operation: '÷', answer: '8', option1: '8', option2: '6', option3: '7', option4: '9', difficulty: 'Hard', know_more: '64 ÷ 8 = 8!' },
      { game_type: 'alien-invasion', num1: '11', num2: '11', operation: '×', answer: '121', option1: '121', option2: '111', option3: '131', option4: '110', difficulty: 'Hard', know_more: '11 × 11 = 121!' },

      // Bubble Pop - Easy
      { game_type: 'bubble-pop', num1: '4', num2: '4', operation: '+', answer: '8', option1: '8', option2: '7', option3: '9', option4: '6', difficulty: 'Easy', know_more: 'Double 4 equals 8!' },
      { game_type: 'bubble-pop', num1: '2', num2: '3', operation: '+', answer: '5', option1: '5', option2: '4', option3: '6', option4: '9', difficulty: 'Easy', know_more: '2 plus 3 is 5!' },
      { game_type: 'bubble-pop', num1: '9', num2: '5', operation: '-', answer: '4', option1: '4', option2: '5', option3: '6', option4: '3', difficulty: 'Easy', know_more: 'Take 5 away from 9 to get 4!' },
      { game_type: 'bubble-pop', num1: '7', num2: '6', operation: '+', answer: '13', option1: '13', option2: '12', option3: '14', option4: '11', difficulty: 'Easy', know_more: '7 + 6 = 13!' },
      { game_type: 'bubble-pop', num1: '11', num2: '3', operation: '-', answer: '8', option1: '8', option2: '7', option3: '9', option4: '6', difficulty: 'Easy', know_more: '11 - 3 = 8!' },
      // Bubble Pop - Medium
      { game_type: 'bubble-pop', num1: '3', num2: '4', operation: '×', answer: '12', option1: '12', option2: '10', option3: '14', option4: '16', difficulty: 'Medium', know_more: '3 × 4 = 12!' },
      { game_type: 'bubble-pop', num1: '5', num2: '5', operation: '×', answer: '25', option1: '25', option2: '20', option3: '30', option4: '15', difficulty: 'Medium', know_more: '5 × 5 = 25!' },
      { game_type: 'bubble-pop', num1: '6', num2: '4', operation: '×', answer: '24', option1: '24', option2: '20', option3: '28', option4: '22', difficulty: 'Medium', know_more: '6 × 4 = 24!' },
      { game_type: 'bubble-pop', num1: '7', num2: '3', operation: '×', answer: '21', option1: '21', option2: '18', option3: '24', option4: '28', difficulty: 'Medium', know_more: '7 × 3 = 21!' },
      { game_type: 'bubble-pop', num1: '8', num2: '5', operation: '×', answer: '40', option1: '40', option2: '35', option3: '45', option4: '48', difficulty: 'Medium', know_more: '8 × 5 = 40!' },
      // Bubble Pop - Hard
      { game_type: 'bubble-pop', num1: '9', num2: '9', operation: '×', answer: '81', option1: '81', option2: '72', option3: '90', option4: '63', difficulty: 'Hard', know_more: '9 × 9 = 81!' },
      { game_type: 'bubble-pop', num1: '72', num2: '8', operation: '÷', answer: '9', option1: '9', option2: '8', option3: '7', option4: '10', difficulty: 'Hard', know_more: '72 ÷ 8 = 9!' },
      { game_type: 'bubble-pop', num1: '11', num2: '7', operation: '×', answer: '77', option1: '77', option2: '84', option3: '70', option4: '66', difficulty: 'Hard', know_more: '11 × 7 = 77!' },
      { game_type: 'bubble-pop', num1: '56', num2: '7', operation: '÷', answer: '8', option1: '8', option2: '7', option3: '9', option4: '6', difficulty: 'Hard', know_more: '56 ÷ 7 = 8!' },
      { game_type: 'bubble-pop', num1: '12', num2: '8', operation: '×', answer: '96', option1: '96', option2: '84', option3: '108', option4: '88', difficulty: 'Hard', know_more: '12 × 8 = 96!' },

      // Planet Hopper - Easy
      { game_type: 'planet-hopper', num1: '2 4 6 ? 10', num2: 'sequence', operation: 'sequence', answer: '8', option1: '8', option2: '6', option3: '10', option4: '12', difficulty: 'Easy', know_more: 'Counting by 2s!' },
      { game_type: 'planet-hopper', num1: '5 10 15 ? 25', num2: 'sequence', operation: 'sequence', answer: '20', option1: '20', option2: '15', option3: '25', option4: '30', difficulty: 'Easy', know_more: 'Counting by 5s!' },
      { game_type: 'planet-hopper', num1: '3 6 9 ? 15', num2: 'sequence', operation: 'sequence', answer: '12', option1: '12', option2: '10', option3: '14', option4: '11', difficulty: 'Easy', know_more: 'Multiples of 3!' },
      { game_type: 'planet-hopper', num1: '10 20 30 ? 50', num2: 'sequence', operation: 'sequence', answer: '40', option1: '40', option2: '35', option3: '45', option4: '60', difficulty: 'Easy', know_more: 'Counting by 10s!' },
      { game_type: 'planet-hopper', num1: '1 2 3 ? 5', num2: 'sequence', operation: 'sequence', answer: '4', option1: '4', option2: '3', option3: '6', option4: '2', difficulty: 'Easy', know_more: 'Counting by 1s!' },
      // Planet Hopper - Medium
      { game_type: 'planet-hopper', num1: '4 8 12 ? 20', num2: 'sequence', operation: 'sequence', answer: '16', option1: '16', option2: '14', option3: '18', option4: '15', difficulty: 'Medium', know_more: 'Counting by 4s!' },
      { game_type: 'planet-hopper', num1: '7 14 21 ? 35', num2: 'sequence', operation: 'sequence', answer: '28', option1: '28', option2: '27', option3: '30', option4: '24', difficulty: 'Medium', know_more: 'Multiples of 7!' },
      { game_type: 'planet-hopper', num1: '6 12 18 ? 30', num2: 'sequence', operation: 'sequence', answer: '24', option1: '24', option2: '22', option3: '26', option4: '20', difficulty: 'Medium', know_more: 'Counting by 6s!' },
      { game_type: 'planet-hopper', num1: '9 18 27 ? 45', num2: 'sequence', operation: 'sequence', answer: '36', option1: '36', option2: '35', option3: '38', option4: '32', difficulty: 'Medium', know_more: 'Multiples of 9!' },
      { game_type: 'planet-hopper', num1: '8 16 24 ? 40', num2: 'sequence', operation: 'sequence', answer: '32', option1: '32', option2: '30', option3: '34', option4: '28', difficulty: 'Medium', know_more: 'Counting by 8s!' },
      // Planet Hopper - Hard
      { game_type: 'planet-hopper', num1: '1 4 9 ? 25', num2: 'sequence', operation: 'sequence', answer: '16', option1: '16', option2: '14', option3: '18', option4: '20', difficulty: 'Hard', know_more: 'Square numbers: 1, 4, 9, 16, 25!' },
      { game_type: 'planet-hopper', num1: '2 4 8 ? 32', num2: 'sequence', operation: 'sequence', answer: '16', option1: '16', option2: '12', option3: '20', option4: '24', difficulty: 'Hard', know_more: 'Doubling sequence!' },
      { game_type: 'planet-hopper', num1: '1 1 2 3 5 ?', num2: 'sequence', operation: 'sequence', answer: '8', option1: '8', option2: '6', option3: '7', option4: '9', difficulty: 'Hard', know_more: 'Fibonacci: add previous two!' },
      { game_type: 'planet-hopper', num1: '11 22 33 ? 55', num2: 'sequence', operation: 'sequence', answer: '44', option1: '44', option2: '42', option3: '45', option4: '40', difficulty: 'Hard', know_more: 'Multiples of 11!' },
      { game_type: 'planet-hopper', num1: '3 9 27 ? 243', num2: 'sequence', operation: 'sequence', answer: '81', option1: '81', option2: '72', option3: '90', option4: '63', difficulty: 'Hard', know_more: 'Powers of 3!' },

      // Fraction Frenzy - Easy
      { game_type: 'fraction-frenzy', num1: '1/2 vs 1/4', num2: 'compare', answer: '1/2', option1: '1/2', option2: '1/4', option3: '1/3', option4: '2/3', difficulty: 'Easy', know_more: 'Half is bigger than quarter!' },
      { game_type: 'fraction-frenzy', num1: '3/4 vs 1/2', num2: 'compare', answer: '3/4', option1: '3/4', option2: '1/2', option3: '2/3', option4: '1/4', difficulty: 'Easy', know_more: 'Three quarters is more than half!' },
      { game_type: 'fraction-frenzy', num1: '2/3 vs 1/3', num2: 'compare', answer: '2/3', option1: '2/3', option2: '1/3', option3: '1/4', option4: '1/2', difficulty: 'Easy', know_more: '2/3 is more than 1/3!' },
      { game_type: 'fraction-frenzy', num1: '1/2 vs 1/8', num2: 'compare', answer: '1/2', option1: '1/2', option2: '1/8', option3: '1/4', option4: '1/3', difficulty: 'Easy', know_more: '1/2 is bigger than 1/8!' },
      { game_type: 'fraction-frenzy', num1: '2/4 vs 1/4', num2: 'compare', answer: '2/4', option1: '2/4', option2: '1/4', option3: '3/4', option4: '1/8', difficulty: 'Easy', know_more: '2 quarters are more than 1!' },
      // Fraction Frenzy - Medium
      { game_type: 'fraction-frenzy', num1: '1/2 + 1/4 = ?', num2: 'add', answer: '3/4', option1: '3/4', option2: '2/6', option3: '1/6', option4: '2/4', difficulty: 'Medium', know_more: '1/2 = 2/4, so 2/4 + 1/4 = 3/4!' },
      { game_type: 'fraction-frenzy', num1: '3/4 - 1/4 = ?', num2: 'subtract', answer: '2/4', option1: '2/4', option2: '3/8', option3: '1/2', option4: '1/4', difficulty: 'Medium', know_more: '3/4 - 1/4 = 2/4 = 1/2!' },
      { game_type: 'fraction-frenzy', num1: '5/8 vs 3/4', num2: 'compare', answer: '3/4', option1: '3/4', option2: '5/8', option3: '1/2', option4: '7/8', difficulty: 'Medium', know_more: '3/4 = 6/8 which is more than 5/8!' },
      { game_type: 'fraction-frenzy', num1: '2/3 vs 3/4', num2: 'compare', answer: '3/4', option1: '3/4', option2: '2/3', option3: '1/2', option4: '5/6', difficulty: 'Medium', know_more: '3/4 is slightly more than 2/3!' },
      { game_type: 'fraction-frenzy', num1: '1/3 + 1/3 = ?', num2: 'add', answer: '2/3', option1: '2/3', option2: '1/6', option3: '2/6', option4: '1/3', difficulty: 'Medium', know_more: '1/3 + 1/3 = 2/3!' },
      // Fraction Frenzy - Hard
      { game_type: 'fraction-frenzy', num1: '2/5 + 3/10 = ?', num2: 'add', answer: '7/10', option1: '7/10', option2: '5/15', option3: '1/2', option4: '5/10', difficulty: 'Hard', know_more: '2/5 = 4/10, so 4/10 + 3/10 = 7/10!' },
      { game_type: 'fraction-frenzy', num1: '5/6 - 1/3 = ?', num2: 'subtract', answer: '1/2', option1: '1/2', option2: '2/3', option3: '4/6', option4: '3/6', difficulty: 'Hard', know_more: '1/3 = 2/6, so 5/6 - 2/6 = 3/6 = 1/2!' },
      { game_type: 'fraction-frenzy', num1: '3/8 + 1/4 = ?', num2: 'add', answer: '5/8', option1: '5/8', option2: '4/12', option3: '1/2', option4: '3/4', difficulty: 'Hard', know_more: '1/4 = 2/8, so 3/8 + 2/8 = 5/8!' },
      { game_type: 'fraction-frenzy', num1: '7/8 vs 4/5', num2: 'compare', answer: '7/8', option1: '7/8', option2: '4/5', option3: '3/4', option4: '5/6', difficulty: 'Hard', know_more: '7/8 = 0.875, 4/5 = 0.8!' },
      { game_type: 'fraction-frenzy', num1: '2/3 + 1/6 = ?', num2: 'add', answer: '5/6', option1: '5/6', option2: '3/9', option3: '1/2', option4: '4/6', difficulty: 'Hard', know_more: '2/3 = 4/6, so 4/6 + 1/6 = 5/6!' },

      // Time Warp - Easy
      { game_type: 'time-warp', num1: '3', num2: '0', operation: 'read', answer: '3:00', option1: '3:00', option2: '6:00', option3: '9:00', option4: '12:00', difficulty: 'Easy', know_more: 'Short hand points to hour!' },
      { game_type: 'time-warp', num1: '6', num2: '0', operation: 'read', answer: '6:00', option1: '6:00', option2: '3:00', option3: '9:00', option4: '12:00', difficulty: 'Easy', know_more: 'Short hand on 6!' },
      { game_type: 'time-warp', num1: '9', num2: '0', operation: 'read', answer: '9:00', option1: '9:00', option2: '6:00', option3: '3:00', option4: '12:00', difficulty: 'Easy', know_more: '9 oclock!' },
      { game_type: 'time-warp', num1: '12', num2: '0', operation: 'read', answer: '12:00', option1: '12:00', option2: '6:00', option3: '9:00', option4: '1:00', difficulty: 'Easy', know_more: 'Both hands point up!' },
      { game_type: 'time-warp', num1: '3', num2: '30', operation: 'read', answer: '3:30', option1: '3:30', option2: '3:00', option3: '4:00', option4: '4:30', difficulty: 'Easy', know_more: 'Half past 3!' },
      // Time Warp - Medium
      { game_type: 'time-warp', num1: '2', num2: '15', operation: 'read', answer: '2:15', option1: '2:15', option2: '2:45', option3: '3:15', option4: '2:30', difficulty: 'Medium', know_more: 'Quarter past 2!' },
      { game_type: 'time-warp', num1: '7', num2: '45', operation: 'read', answer: '7:45', option1: '7:45', option2: '8:45', option3: '7:15', option4: '8:15', difficulty: 'Medium', know_more: 'Quarter to 8!' },
      { game_type: 'time-warp', num1: '11', num2: '30', operation: 'read', answer: '11:30', option1: '11:30', option2: '12:30', option3: '11:00', option4: '10:30', difficulty: 'Medium', know_more: 'Half past 11!' },
      { game_type: 'time-warp', num1: '4', num2: '15', operation: 'read', answer: '4:15', option1: '4:15', option2: '4:45', option3: '3:15', option4: '5:15', difficulty: 'Medium', know_more: 'Quarter past 4!' },
      { game_type: 'time-warp', num1: '8', num2: '45', operation: 'read', answer: '8:45', option1: '8:45', option2: '9:45', option3: '8:15', option4: '9:15', difficulty: 'Medium', know_more: 'Quarter to 9!' },
      // Time Warp - Hard
      { game_type: 'time-warp', num1: '2:30', num2: '4:15', operation: 'duration', answer: '1:45', option1: '1:45', option2: '1:30', option3: '2:00', option4: '1:15', difficulty: 'Hard', know_more: 'From 2:30 to 4:15 is 1 hour 45 minutes!' },
      { game_type: 'time-warp', num1: '9', num2: '23', operation: 'read', answer: '9:23', option1: '9:23', option2: '9:25', option3: '9:20', option4: '9:30', difficulty: 'Hard', know_more: 'Minute hand past 4!' },
      { game_type: 'time-warp', num1: '10:15', num2: '11:45', operation: 'duration', answer: '1:30', option1: '1:30', option2: '1:15', option3: '1:45', option4: '1:00', difficulty: 'Hard', know_more: '90 minutes = 1:30!' },
      { game_type: 'time-warp', num1: '5', num2: '37', operation: 'read', answer: '5:37', option1: '5:37', option2: '5:35', option3: '5:40', option4: '5:30', difficulty: 'Hard', know_more: 'Minute hand past 7!' },
      { game_type: 'time-warp', num1: '3:45', num2: '5:30', operation: 'duration', answer: '1:45', option1: '1:45', option2: '2:15', option3: '1:30', option4: '2:00', difficulty: 'Hard', know_more: 'From 3:45 to 5:30 is 1:45!' },

      // Money Master - Easy
      { game_type: 'money-master', num1: '2 quarters + 1 dime', num2: 'count', answer: '60¢', option1: '60¢', option2: '50¢', option3: '70¢', option4: '55¢', difficulty: 'Easy', know_more: '25+25+10 = 60¢' },
      { game_type: 'money-master', num1: '3 dimes', num2: 'count', answer: '30¢', option1: '30¢', option2: '25¢', option3: '35¢', option4: '40¢', difficulty: 'Easy', know_more: '10+10+10 = 30¢' },
      { game_type: 'money-master', num1: '1 quarter + 2 dimes', num2: 'count', answer: '45¢', option1: '45¢', option2: '40¢', option3: '50¢', option4: '35¢', difficulty: 'Easy', know_more: '25+10+10 = 45¢' },
      { game_type: 'money-master', num1: '1 quarter + 1 dime', num2: 'count', answer: '35¢', option1: '35¢', option2: '30¢', option3: '40¢', option4: '45¢', difficulty: 'Easy', know_more: '25+10 = 35¢' },
      { game_type: 'money-master', num1: '5 dimes', num2: 'count', answer: '50¢', option1: '50¢', option2: '45¢', option3: '55¢', option4: '40¢', difficulty: 'Easy', know_more: '5 times 10 = 50¢' },
      // Money Master - Medium
      { game_type: 'money-master', num1: '3 quarters + 2 nickels', num2: 'count', answer: '85¢', option1: '85¢', option2: '80¢', option3: '90¢', option4: '75¢', difficulty: 'Medium', know_more: '75 + 10 = 85¢' },
      { game_type: 'money-master', num1: '1 dollar - 35¢', num2: 'change', answer: '65¢', option1: '65¢', option2: '75¢', option3: '55¢', option4: '60¢', difficulty: 'Medium', know_more: '100 - 35 = 65¢' },
      { game_type: 'money-master', num1: '4 quarters', num2: 'count', answer: '$1.00', option1: '$1.00', option2: '75¢', option3: '$1.25', option4: '80¢', difficulty: 'Medium', know_more: '4 × 25 = 100¢ = $1!' },
      { game_type: 'money-master', num1: '1 dollar - 47¢', num2: 'change', answer: '53¢', option1: '53¢', option2: '63¢', option3: '43¢', option4: '57¢', difficulty: 'Medium', know_more: '100 - 47 = 53¢' },
      { game_type: 'money-master', num1: '2 quarters + 3 dimes + 1 nickel', num2: 'count', answer: '85¢', option1: '85¢', option2: '80¢', option3: '90¢', option4: '75¢', difficulty: 'Medium', know_more: '50+30+5 = 85¢' },
      // Money Master - Hard
      { game_type: 'money-master', num1: '$5.00 - $2.37', num2: 'change', answer: '$2.63', option1: '$2.63', option2: '$2.73', option3: '$2.53', option4: '$3.63', difficulty: 'Hard', know_more: 'Subtract with borrowing!' },
      { game_type: 'money-master', num1: '$3.75 + $2.48', num2: 'count', answer: '$6.23', option1: '$6.23', option2: '$6.13', option3: '$6.33', option4: '$5.23', difficulty: 'Hard', know_more: 'Add dollars then cents!' },
      { game_type: 'money-master', num1: '$10.00 - $7.82', num2: 'change', answer: '$2.18', option1: '$2.18', option2: '$2.28', option3: '$3.18', option4: '$2.08', difficulty: 'Hard', know_more: '10 - 7.82 = 2.18!' },
      { game_type: 'money-master', num1: '$4.50 + $3.75', num2: 'count', answer: '$8.25', option1: '$8.25', option2: '$8.15', option3: '$7.25', option4: '$8.35', difficulty: 'Hard', know_more: '4.50 + 3.75 = 8.25!' },
      { game_type: 'money-master', num1: '$20.00 - $13.47', num2: 'change', answer: '$6.53', option1: '$6.53', option2: '$7.53', option3: '$6.43', option4: '$6.63', difficulty: 'Hard', know_more: 'Subtract from $20!' },

      // Geometry Galaxy - Easy
      { game_type: 'geometry-galaxy', num1: 'triangle', text1: 'triangle', operation: 'identify', answer: 'Triangle', option1: 'Triangle', option2: 'Square', option3: 'Circle', option4: 'Rectangle', difficulty: 'Easy', know_more: 'Triangle has 3 sides!' },
      { game_type: 'geometry-galaxy', num1: 'square', text1: 'square', operation: 'identify', answer: 'Square', option1: 'Square', option2: 'Triangle', option3: 'Circle', option4: 'Rectangle', difficulty: 'Easy', know_more: 'All 4 sides equal!' },
      { game_type: 'geometry-galaxy', num1: 'circle', text1: 'circle', operation: 'identify', answer: 'Circle', option1: 'Circle', option2: 'Oval', option3: 'Square', option4: 'Triangle', difficulty: 'Easy', know_more: 'Perfectly round!' },
      { game_type: 'geometry-galaxy', num1: 'rectangle', text1: 'rectangle', operation: 'identify', answer: 'Rectangle', option1: 'Rectangle', option2: 'Square', option3: 'Triangle', option4: 'Oval', difficulty: 'Easy', know_more: '4 sides, opposite sides equal!' },
      { game_type: 'geometry-galaxy', num1: 'pentagon', text1: 'pentagon', operation: 'identify', answer: 'Pentagon', option1: 'Pentagon', option2: 'Hexagon', option3: 'Square', option4: 'Octagon', difficulty: 'Easy', know_more: 'Pentagon has 5 sides!' },
      // Geometry Galaxy - Medium
      { game_type: 'geometry-galaxy', num1: 'hexagon', text1: 'hexagon', operation: 'identify', answer: 'Hexagon', option1: 'Hexagon', option2: 'Pentagon', option3: 'Octagon', option4: 'Square', difficulty: 'Medium', know_more: 'Hexagon has 6 sides!' },
      { game_type: 'geometry-galaxy', num1: 'triangle', text1: 'triangle', operation: 'sides', answer: '3', option1: '3', option2: '4', option3: '5', option4: '6', difficulty: 'Medium', know_more: 'Tri means 3!' },
      { game_type: 'geometry-galaxy', num1: 'octagon', text1: 'octagon', operation: 'identify', answer: 'Octagon', option1: 'Octagon', option2: 'Hexagon', option3: 'Pentagon', option4: 'Decagon', difficulty: 'Medium', know_more: 'Octagon has 8 sides - like a stop sign!' },
      { game_type: 'geometry-galaxy', num1: 'hexagon', text1: 'hexagon', operation: 'sides', answer: '6', option1: '6', option2: '5', option3: '7', option4: '8', difficulty: 'Medium', know_more: 'Hex means 6!' },
      { game_type: 'geometry-galaxy', num1: 'pentagon', text1: 'pentagon', operation: 'sides', answer: '5', option1: '5', option2: '4', option3: '6', option4: '7', difficulty: 'Medium', know_more: 'Penta means 5!' },
      // Geometry Galaxy - Hard
      { game_type: 'geometry-galaxy', num1: '4', text1: 'square', operation: 'perimeter', answer: '16', option1: '16', option2: '12', option3: '20', option4: '8', difficulty: 'Hard', know_more: 'Perimeter = 4 × side = 4 × 4 = 16!' },
      { game_type: 'geometry-galaxy', num1: '5', text1: 'square', operation: 'area', answer: '25', option1: '25', option2: '20', option3: '10', option4: '30', difficulty: 'Hard', know_more: 'Area = side × side = 5 × 5 = 25!' },
      { game_type: 'geometry-galaxy', num1: '3', text1: 'square', operation: 'perimeter', answer: '12', option1: '12', option2: '9', option3: '6', option4: '15', difficulty: 'Hard', know_more: 'Perimeter = 4 × 3 = 12!' },
      { game_type: 'geometry-galaxy', num1: '6', text1: 'square', operation: 'area', answer: '36', option1: '36', option2: '24', option3: '12', option4: '42', difficulty: 'Hard', know_more: 'Area = 6 × 6 = 36!' },
      { game_type: 'geometry-galaxy', num1: '7', text1: 'square', operation: 'perimeter', answer: '28', option1: '28', option2: '21', option3: '35', option4: '49', difficulty: 'Hard', know_more: 'Perimeter = 4 × 7 = 28!' },
    ];

    const FALLBACK_ENGLISH_DATA = [
      // Grammar Galaxy - Easy
      { game_type: 'grammar-galaxy', text1: 'She don\'t like apples.', text2: 'Subject-Verb Agreement', answer: 'doesn\'t', option1: 'doesn\'t', option2: 'don\'t', option3: 'didn\'t', option4: 'won\'t', difficulty: 'Easy', know_more: 'Use doesn\'t with he/she/it!' },
      { game_type: 'grammar-galaxy', text1: 'The cats is sleeping.', text2: 'Subject-Verb Agreement', answer: 'are', option1: 'is', option2: 'are', option3: 'was', option4: 'be', difficulty: 'Easy', know_more: 'Use are for plural!' },
      { game_type: 'grammar-galaxy', text1: 'Him went to school.', text2: 'Pronoun', answer: 'He', option1: 'He', option2: 'Him', option3: 'His', option4: 'Her', difficulty: 'Easy', know_more: 'Use He as subject!' },
      { game_type: 'grammar-galaxy', text1: 'I seen the movie.', text2: 'Verb Tense', answer: 'saw', option1: 'saw', option2: 'seen', option3: 'see', option4: 'seeing', difficulty: 'Easy', know_more: 'Saw is simple past!' },
      { game_type: 'grammar-galaxy', text1: 'They was happy.', text2: 'Subject-Verb', answer: 'were', option1: 'were', option2: 'was', option3: 'is', option4: 'be', difficulty: 'Easy', know_more: 'Use were with They!' },
      // Grammar Galaxy - Medium
      { game_type: 'grammar-galaxy', text1: 'Neither of the boys are coming.', text2: 'Subject-Verb Agreement', answer: 'is', option1: 'is', option2: 'are', option3: 'were', option4: 'be', difficulty: 'Medium', know_more: 'Neither takes singular verb!' },
      { game_type: 'grammar-galaxy', text1: 'Each of the students have a book.', text2: 'Subject-Verb Agreement', answer: 'has', option1: 'has', option2: 'have', option3: 'had', option4: 'having', difficulty: 'Medium', know_more: 'Each is singular!' },
      { game_type: 'grammar-galaxy', text1: 'Me and him went to the park.', text2: 'Pronoun', answer: 'He and I', option1: 'He and I', option2: 'Me and him', option3: 'Him and me', option4: 'I and he', difficulty: 'Medium', know_more: 'Use I/He as subjects!' },
      { game_type: 'grammar-galaxy', text1: 'The team are playing good.', text2: 'Adverb', answer: 'well', option1: 'well', option2: 'good', option3: 'better', option4: 'best', difficulty: 'Medium', know_more: 'Well is an adverb!' },
      { game_type: 'grammar-galaxy', text1: 'She runned to the store.', text2: 'Irregular Verb', answer: 'ran', option1: 'ran', option2: 'runned', option3: 'run', option4: 'running', difficulty: 'Medium', know_more: 'Run → ran (irregular)!' },
      // Grammar Galaxy - Hard
      { game_type: 'grammar-galaxy', text1: 'The data shows that the hypothesis were correct.', text2: 'Subject-Verb', answer: 'was', option1: 'was', option2: 'were', option3: 'are', option4: 'is', difficulty: 'Hard', know_more: 'Hypothesis is singular!' },
      { game_type: 'grammar-galaxy', text1: 'Between you and I, this is a secret.', text2: 'Pronoun Case', answer: 'me', option1: 'me', option2: 'I', option3: 'myself', option4: 'mine', difficulty: 'Hard', know_more: 'Object of preposition needs me!' },
      { game_type: 'grammar-galaxy', text1: 'If I was you, I would study more.', text2: 'Subjunctive', answer: 'were', option1: 'were', option2: 'was', option3: 'am', option4: 'be', difficulty: 'Hard', know_more: 'Subjunctive uses were!' },
      { game_type: 'grammar-galaxy', text1: 'The criteria for success is clear.', text2: 'Plural Form', answer: 'are', option1: 'are', option2: 'is', option3: 'was', option4: 'has', difficulty: 'Hard', know_more: 'Criteria is plural!' },
      { game_type: 'grammar-galaxy', text1: 'Who did you give it to?', text2: 'Pronoun Case', answer: 'Whom', option1: 'Whom', option2: 'Who', option3: 'Whose', option4: 'Which', difficulty: 'Hard', know_more: 'Whom is object form!' },

      // Word Class Warp - Easy
      { game_type: 'word-class-warp', text1: 'dog', answer: 'noun', difficulty: 'Easy', know_more: 'Noun = person, place, thing!' },
      { game_type: 'word-class-warp', text1: 'run', answer: 'verb', difficulty: 'Easy', know_more: 'Verb = action word!' },
      { game_type: 'word-class-warp', text1: 'beautiful', answer: 'adjective', difficulty: 'Easy', know_more: 'Adjective describes nouns!' },
      { game_type: 'word-class-warp', text1: 'quickly', answer: 'adverb', difficulty: 'Easy', know_more: 'Adverb describes verbs!' },
      { game_type: 'word-class-warp', text1: 'happiness', answer: 'noun', difficulty: 'Easy', know_more: 'Happiness is a thing!' },
      // Word Class Warp - Medium
      { game_type: 'word-class-warp', text1: 'carefully', answer: 'adverb', difficulty: 'Medium', know_more: '-ly ending often = adverb!' },
      { game_type: 'word-class-warp', text1: 'freedom', answer: 'noun', difficulty: 'Medium', know_more: 'Abstract nouns are things too!' },
      { game_type: 'word-class-warp', text1: 'exciting', answer: 'adjective', difficulty: 'Medium', know_more: '-ing can be adjective!' },
      { game_type: 'word-class-warp', text1: 'discover', answer: 'verb', difficulty: 'Medium', know_more: 'Discover is an action!' },
      { game_type: 'word-class-warp', text1: 'extremely', answer: 'adverb', difficulty: 'Medium', know_more: 'Modifies adjectives/adverbs!' },
      // Word Class Warp - Hard
      { game_type: 'word-class-warp', text1: 'however', answer: 'adverb', difficulty: 'Hard', know_more: 'Conjunctive adverb!' },
      { game_type: 'word-class-warp', text1: 'running (as in running water)', answer: 'adjective', difficulty: 'Hard', know_more: 'Participle as adjective!' },
      { game_type: 'word-class-warp', text1: 'the rich', answer: 'noun', difficulty: 'Hard', know_more: 'Adjective used as noun!' },
      { game_type: 'word-class-warp', text1: 'fast (he runs fast)', answer: 'adverb', difficulty: 'Hard', know_more: 'Fast can be adverb!' },
      { game_type: 'word-class-warp', text1: 'swimming (swimming is fun)', answer: 'noun', difficulty: 'Hard', know_more: 'Gerund acts as noun!' },

      // Punctuation Pop - Easy
      { game_type: 'punctuation-pop', text1: 'What time is it', answer: '?', difficulty: 'Easy', know_more: 'Questions need ?' },
      { game_type: 'punctuation-pop', text1: 'I love ice cream', answer: '.', difficulty: 'Easy', know_more: 'Statements end with .' },
      { game_type: 'punctuation-pop', text1: 'Wow that is amazing', answer: '!', difficulty: 'Easy', know_more: 'Exclamations use !' },
      { game_type: 'punctuation-pop', text1: 'Where are you going', answer: '?', difficulty: 'Easy', know_more: 'Questions need ?' },
      { game_type: 'punctuation-pop', text1: 'Stop right there', answer: '!', difficulty: 'Easy', know_more: 'Commands can use !' },
      // Punctuation Pop - Medium
      { game_type: 'punctuation-pop', text1: 'She bought apples oranges and bananas', answer: ',', difficulty: 'Medium', know_more: 'Commas separate list items!' },
      { game_type: 'punctuation-pop', text1: 'However we decided to go', answer: ',', difficulty: 'Medium', know_more: 'Comma after introductory word!' },
      { game_type: 'punctuation-pop', text1: 'Its a beautiful day', answer: '\'', difficulty: 'Medium', know_more: 'It\'s needs apostrophe!' },
      { game_type: 'punctuation-pop', text1: 'Dear Santa', answer: ',', difficulty: 'Medium', know_more: 'Comma after greeting!' },
      { game_type: 'punctuation-pop', text1: 'Wait for me she shouted', answer: '!', difficulty: 'Medium', know_more: 'Shouting = exclamation!' },
      // Punctuation Pop - Hard
      { game_type: 'punctuation-pop', text1: 'The following items are needed paper pencils and erasers', answer: ':', difficulty: 'Hard', know_more: 'Colon before a list!' },
      { game_type: 'punctuation-pop', text1: 'She said Hello', answer: ',', difficulty: 'Hard', know_more: 'Comma before quotation!' },
      { game_type: 'punctuation-pop', text1: 'James book was lost', answer: '\'', difficulty: 'Hard', know_more: 'Apostrophe for possession!' },
      { game_type: 'punctuation-pop', text1: 'Its raining therefore we stayed inside', answer: ';', difficulty: 'Hard', know_more: 'Semicolon joins clauses!' },
      { game_type: 'punctuation-pop', text1: 'The well known author spoke', answer: '-', difficulty: 'Hard', know_more: 'Hyphen in compound adjective!' },

      // Tense Traveler - Easy
      { game_type: 'tense-traveler', text1: 'walk', text2: 'past', answer: 'walked', option1: 'walk', option2: 'walked', option3: 'walks', option4: 'will walk', difficulty: 'Easy', know_more: 'Add -ed for past!' },
      { game_type: 'tense-traveler', text1: 'run', text2: 'past', answer: 'ran', option1: 'run', option2: 'ran', option3: 'runs', option4: 'will run', difficulty: 'Easy', know_more: 'Run is irregular!' },
      { game_type: 'tense-traveler', text1: 'walk', text2: 'future', answer: 'will walk', option1: 'walked', option2: 'walks', option3: 'will walk', option4: 'walking', difficulty: 'Easy', know_more: 'Future uses will!' },
      { game_type: 'tense-traveler', text1: 'play', text2: 'past', answer: 'played', option1: 'play', option2: 'played', option3: 'plays', option4: 'playing', difficulty: 'Easy', know_more: 'Add -ed for regular verbs!' },
      { game_type: 'tense-traveler', text1: 'jump', text2: 'future', answer: 'will jump', option1: 'jumped', option2: 'jumps', option3: 'will jump', option4: 'jumping', difficulty: 'Easy', know_more: 'Will + base verb!' },
      // Tense Traveler - Medium
      { game_type: 'tense-traveler', text1: 'eat', text2: 'past', answer: 'ate', option1: 'eated', option2: 'ate', option3: 'eats', option4: 'eat', difficulty: 'Medium', know_more: 'Eat → Ate (irregular)!' },
      { game_type: 'tense-traveler', text1: 'sing', text2: 'past', answer: 'sang', option1: 'singed', option2: 'sang', option3: 'sung', option4: 'sing', difficulty: 'Medium', know_more: 'Sing → Sang!' },
      { game_type: 'tense-traveler', text1: 'write', text2: 'past', answer: 'wrote', option1: 'writed', option2: 'wrote', option3: 'written', option4: 'write', difficulty: 'Medium', know_more: 'Write → Wrote!' },
      { game_type: 'tense-traveler', text1: 'swim', text2: 'past', answer: 'swam', option1: 'swimmed', option2: 'swam', option3: 'swum', option4: 'swim', difficulty: 'Medium', know_more: 'Swim → Swam!' },
      { game_type: 'tense-traveler', text1: 'begin', text2: 'past', answer: 'began', option1: 'beginned', option2: 'began', option3: 'begun', option4: 'begin', difficulty: 'Medium', know_more: 'Begin → Began!' },
      // Tense Traveler - Hard
      { game_type: 'tense-traveler', text1: 'study', text2: 'present perfect', answer: 'has studied', option1: 'studied', option2: 'has studied', option3: 'studies', option4: 'will study', difficulty: 'Hard', know_more: 'Has/Have + past participle!' },
      { game_type: 'tense-traveler', text1: 'drive', text2: 'past participle', answer: 'driven', option1: 'drived', option2: 'drove', option3: 'driven', option4: 'drive', difficulty: 'Hard', know_more: 'Drive → Drove → Driven!' },
      { game_type: 'tense-traveler', text1: 'work', text2: 'past continuous', answer: 'was working', option1: 'worked', option2: 'was working', option3: 'works', option4: 'will work', difficulty: 'Hard', know_more: 'Was/Were + -ing!' },
      { game_type: 'tense-traveler', text1: 'fly', text2: 'past participle', answer: 'flown', option1: 'flied', option2: 'flew', option3: 'flown', option4: 'fly', difficulty: 'Hard', know_more: 'Fly → Flew → Flown!' },
      { game_type: 'tense-traveler', text1: 'break', text2: 'past participle', answer: 'broken', option1: 'breaked', option2: 'broke', option3: 'broken', option4: 'break', difficulty: 'Hard', know_more: 'Break → Broke → Broken!' },

      // Synonym Stars - Easy
      { game_type: 'synonym-stars', text1: 'happy', answer: 'joyful', option2: 'sad', option3: 'angry', option4: 'tired', difficulty: 'Easy', know_more: 'Synonyms mean the same!' },
      { game_type: 'synonym-stars', text1: 'big', answer: 'large', option2: 'small', option3: 'tiny', option4: 'short', difficulty: 'Easy', know_more: 'Big = Large!' },
      { game_type: 'synonym-stars', text1: 'fast', answer: 'quick', option2: 'slow', option3: 'lazy', option4: 'heavy', difficulty: 'Easy', know_more: 'Fast = Quick!' },
      { game_type: 'synonym-stars', text1: 'smart', answer: 'intelligent', option2: 'dumb', option3: 'slow', option4: 'weak', difficulty: 'Easy', know_more: 'Smart = Intelligent!' },
      { game_type: 'synonym-stars', text1: 'small', answer: 'tiny', option2: 'huge', option3: 'giant', option4: 'massive', difficulty: 'Easy', know_more: 'Small = Tiny!' },
      // Synonym Stars - Medium
      { game_type: 'synonym-stars', text1: 'begin', answer: 'start', option2: 'end', option3: 'stop', option4: 'finish', difficulty: 'Medium', know_more: 'Begin = Start!' },
      { game_type: 'synonym-stars', text1: 'brave', answer: 'courageous', option2: 'scared', option3: 'weak', option4: 'timid', difficulty: 'Medium', know_more: 'Brave = Courageous!' },
      { game_type: 'synonym-stars', text1: 'difficult', answer: 'challenging', option2: 'easy', option3: 'simple', option4: 'basic', difficulty: 'Medium', know_more: 'Difficult = Challenging!' },
      { game_type: 'synonym-stars', text1: 'generous', answer: 'giving', option2: 'selfish', option3: 'greedy', option4: 'stingy', difficulty: 'Medium', know_more: 'Generous = Giving!' },
      { game_type: 'synonym-stars', text1: 'ancient', answer: 'old', option2: 'new', option3: 'modern', option4: 'recent', difficulty: 'Medium', know_more: 'Ancient = Very old!' },
      // Synonym Stars - Hard
      { game_type: 'synonym-stars', text1: 'benevolent', answer: 'kind', option2: 'cruel', option3: 'mean', option4: 'harsh', difficulty: 'Hard', know_more: 'Benevolent = Kind/Generous!' },
      { game_type: 'synonym-stars', text1: 'eloquent', answer: 'articulate', option2: 'silent', option3: 'quiet', option4: 'shy', difficulty: 'Hard', know_more: 'Eloquent = Well-spoken!' },
      { game_type: 'synonym-stars', text1: 'meticulous', answer: 'careful', option2: 'careless', option3: 'sloppy', option4: 'messy', difficulty: 'Hard', know_more: 'Meticulous = Very detailed!' },
      { game_type: 'synonym-stars', text1: 'ubiquitous', answer: 'everywhere', option2: 'rare', option3: 'scarce', option4: 'uncommon', difficulty: 'Hard', know_more: 'Ubiquitous = Found everywhere!' },
      { game_type: 'synonym-stars', text1: 'ephemeral', answer: 'temporary', option2: 'permanent', option3: 'lasting', option4: 'eternal', difficulty: 'Hard', know_more: 'Ephemeral = Short-lived!' },

      // Antonym Asteroids - Easy
      { game_type: 'antonym-asteroids', text1: 'happy', answer: 'sad', option2: 'joyful', option3: 'glad', option4: 'pleased', difficulty: 'Easy', know_more: 'Antonyms are opposites!' },
      { game_type: 'antonym-asteroids', text1: 'big', answer: 'small', option2: 'large', option3: 'huge', option4: 'giant', difficulty: 'Easy', know_more: 'Big ↔ Small!' },
      { game_type: 'antonym-asteroids', text1: 'fast', answer: 'slow', option2: 'quick', option3: 'rapid', option4: 'swift', difficulty: 'Easy', know_more: 'Fast ↔ Slow!' },
      { game_type: 'antonym-asteroids', text1: 'hot', answer: 'cold', option2: 'warm', option3: 'burning', option4: 'heated', difficulty: 'Easy', know_more: 'Hot ↔ Cold!' },
      { game_type: 'antonym-asteroids', text1: 'up', answer: 'down', option2: 'high', option3: 'above', option4: 'over', difficulty: 'Easy', know_more: 'Up ↔ Down!' },
      // Antonym Asteroids - Medium
      { game_type: 'antonym-asteroids', text1: 'old', answer: 'new', option2: 'ancient', option3: 'aged', option4: 'mature', difficulty: 'Medium', know_more: 'Old ↔ New!' },
      { game_type: 'antonym-asteroids', text1: 'brave', answer: 'cowardly', option2: 'fearless', option3: 'bold', option4: 'daring', difficulty: 'Medium', know_more: 'Brave ↔ Cowardly!' },
      { game_type: 'antonym-asteroids', text1: 'generous', answer: 'selfish', option2: 'kind', option3: 'giving', option4: 'charitable', difficulty: 'Medium', know_more: 'Generous ↔ Selfish!' },
      { game_type: 'antonym-asteroids', text1: 'honest', answer: 'dishonest', option2: 'truthful', option3: 'sincere', option4: 'genuine', difficulty: 'Medium', know_more: 'Honest ↔ Dishonest!' },
      { game_type: 'antonym-asteroids', text1: 'polite', answer: 'rude', option2: 'courteous', option3: 'kind', option4: 'respectful', difficulty: 'Medium', know_more: 'Polite ↔ Rude!' },
      // Antonym Asteroids - Hard
      { game_type: 'antonym-asteroids', text1: 'benevolent', answer: 'malevolent', option2: 'kind', option3: 'generous', option4: 'caring', difficulty: 'Hard', know_more: 'Benevolent ↔ Malevolent!' },
      { game_type: 'antonym-asteroids', text1: 'verbose', answer: 'concise', option2: 'wordy', option3: 'lengthy', option4: 'long-winded', difficulty: 'Hard', know_more: 'Verbose ↔ Concise!' },
      { game_type: 'antonym-asteroids', text1: 'frugal', answer: 'wasteful', option2: 'thrifty', option3: 'economical', option4: 'careful', difficulty: 'Hard', know_more: 'Frugal ↔ Wasteful!' },
      { game_type: 'antonym-asteroids', text1: 'apathy', answer: 'enthusiasm', option2: 'indifference', option3: 'disinterest', option4: 'unconcern', difficulty: 'Hard', know_more: 'Apathy ↔ Enthusiasm!' },
      { game_type: 'antonym-asteroids', text1: 'transparent', answer: 'opaque', option2: 'clear', option3: 'see-through', option4: 'obvious', difficulty: 'Hard', know_more: 'Transparent ↔ Opaque!' },

      // Story Nebula - Easy
      { game_type: 'story-nebula', text1: 'The Lost Puppy', text2: 'Emma found a small puppy in the park. It was brown with white spots and looked hungry. She gave it her sandwich.', answer: 'Where did Emma find the puppy?', option1: 'In the park', option2: 'At school', option3: 'At home', option4: 'In a store', difficulty: 'Easy', know_more: 'Read for details!' },
      { game_type: 'story-nebula', text1: 'The Lost Puppy', text2: 'Emma found a small puppy in the park. It was brown with white spots and looked hungry. She gave it her sandwich.', answer: 'What color was the puppy?', option1: 'Brown with white spots', option2: 'Black', option3: 'White', option4: 'Gray', difficulty: 'Easy', know_more: 'Look for descriptions!' },
      { game_type: 'story-nebula', text1: 'The Lost Puppy', text2: 'Emma found a small puppy in the park. It was brown with white spots and looked hungry. She gave it her sandwich.', answer: 'What did Emma give the puppy?', option1: 'Her sandwich', option2: 'Water', option3: 'A toy', option4: 'Nothing', difficulty: 'Easy', know_more: 'She shared food!' },
      { game_type: 'story-nebula', text1: 'Rainy Day', text2: 'Tom watched the rain fall outside his window. He wanted to play soccer but had to stay inside. He decided to read a book instead.', answer: 'Why did Tom stay inside?', option1: 'It was raining', option2: 'He was sick', option3: 'He was tired', option4: 'His mom said no', difficulty: 'Easy', know_more: 'The rain made him stay!' },
      { game_type: 'story-nebula', text1: 'Rainy Day', text2: 'Tom watched the rain fall outside his window. He wanted to play soccer but had to stay inside. He decided to read a book instead.', answer: 'What did Tom want to do?', option1: 'Play soccer', option2: 'Read a book', option3: 'Watch TV', option4: 'Sleep', difficulty: 'Easy', know_more: 'He wanted to play!' },
      // Story Nebula - Medium
      { game_type: 'story-nebula', text1: 'The Science Fair', text2: 'Maya spent three weeks building her volcano model. On the day of the fair, she added baking soda and vinegar. The eruption impressed all the judges and she won first place.', answer: 'How long did Maya work on her project?', option1: 'Three weeks', option2: 'One day', option3: 'Two months', option4: 'One week', difficulty: 'Medium', know_more: 'Time details matter!' },
      { game_type: 'story-nebula', text1: 'The Science Fair', text2: 'Maya spent three weeks building her volcano model. On the day of the fair, she added baking soda and vinegar. The eruption impressed all the judges and she won first place.', answer: 'What made the volcano erupt?', option1: 'Baking soda and vinegar', option2: 'Water', option3: 'Fire', option4: 'Electricity', difficulty: 'Medium', know_more: 'Chemical reaction!' },
      { game_type: 'story-nebula', text1: 'The Garden', text2: 'Grandma planted seeds in spring. She watered them every day and pulled weeds. By summer, her garden was full of tomatoes, cucumbers, and peppers.', answer: 'When did Grandma plant seeds?', option1: 'In spring', option2: 'In summer', option3: 'In winter', option4: 'In fall', difficulty: 'Medium', know_more: 'Spring is planting time!' },
      { game_type: 'story-nebula', text1: 'The Garden', text2: 'Grandma planted seeds in spring. She watered them every day and pulled weeds. By summer, her garden was full of tomatoes, cucumbers, and peppers.', answer: 'What vegetables grew?', option1: 'Tomatoes, cucumbers, peppers', option2: 'Carrots only', option3: 'Potatoes', option4: 'Corn', difficulty: 'Medium', know_more: 'List all three!' },
      { game_type: 'story-nebula', text1: 'The Big Game', text2: 'The score was tied 2-2 with one minute left. Sarah kicked the ball toward the goal. It went past the goalie and her team won the championship.', answer: 'What was the final score?', option1: '3-2', option2: '2-2', option3: '4-2', option4: '3-3', difficulty: 'Medium', know_more: 'Add Sarah\'s goal!' },
      // Story Nebula - Hard
      { game_type: 'story-nebula', text1: 'The Mystery', text2: 'Detective Chen examined the broken window. Glass fragments were outside on the ground, not inside. She knew immediately that the window had been broken from inside the house.', answer: 'Where were the glass fragments?', option1: 'Outside on the ground', option2: 'Inside the house', option3: 'On the windowsill', option4: 'Everywhere', difficulty: 'Hard', know_more: 'Clue reveals the truth!' },
      { game_type: 'story-nebula', text1: 'The Experiment', text2: 'The scientist mixed two clear liquids together. Nothing seemed to happen at first. But after five minutes, the mixture turned bright purple and began to bubble.', answer: 'What happened after five minutes?', option1: 'Turned purple and bubbled', option2: 'Exploded', option3: 'Stayed the same', option4: 'Turned red', difficulty: 'Hard', know_more: 'Patience shows results!' },
      { game_type: 'story-nebula', text1: 'The Journey', text2: 'The travelers left at dawn from the eastern village. They walked for six hours, stopping only once for water. By noon, they could see the western mountains in the distance.', answer: 'What direction did they travel?', option1: 'West', option2: 'East', option3: 'North', option4: 'South', difficulty: 'Hard', know_more: 'East to west!' },
      { game_type: 'story-nebula', text1: 'The Recipe', text2: 'First, mix flour and sugar. Add eggs one at a time. Finally, fold in chocolate chips. The recipe makes 24 cookies if you use one tablespoon of dough for each.', answer: 'How many cookies does this make?', option1: '24', option2: '12', option3: '36', option4: '48', difficulty: 'Hard', know_more: 'One tablespoon each!' },
      { game_type: 'story-nebula', text1: 'The Discovery', text2: 'The archaeologist brushed away sand to reveal ancient writing. The symbols were similar to Egyptian hieroglyphics but had subtle differences. This could rewrite history.', answer: 'What did the archaeologist find?', option1: 'Ancient writing', option2: 'Gold coins', option3: 'A mummy', option4: 'Pottery', difficulty: 'Hard', know_more: 'Symbols tell stories!' },

      // Inference Investigator - Easy
      { game_type: 'inference-investigator', text1: 'Maria grabbed her umbrella before leaving.', text2: 'What can you infer about the weather?', answer: 'It might rain', option1: 'It might rain', option2: 'Very hot', option3: 'Snowing', option4: 'Windy', difficulty: 'Easy', know_more: 'Umbrella = expecting rain!' },
      { game_type: 'inference-investigator', text1: 'The boy\'s eyes grew wide when he opened the present.', text2: 'How did the boy feel?', answer: 'Surprised or excited', option1: 'Surprised or excited', option2: 'Disappointed', option3: 'Angry', option4: 'Bored', difficulty: 'Easy', know_more: 'Wide eyes = surprise!' },
      { game_type: 'inference-investigator', text1: 'Sarah yawned and rubbed her eyes.', text2: 'What can you infer?', answer: 'She was tired', option1: 'She was tired', option2: 'She was hungry', option3: 'She was scared', option4: 'She was cold', difficulty: 'Easy', know_more: 'Yawning = tired!' },
      { game_type: 'inference-investigator', text1: 'The dog wagged its tail when Tom came home.', text2: 'How did the dog feel?', answer: 'Happy', option1: 'Happy', option2: 'Sad', option3: 'Angry', option4: 'Scared', difficulty: 'Easy', know_more: 'Tail wagging = happy!' },
      { game_type: 'inference-investigator', text1: 'Mom put candles on the cake.', text2: 'What event is happening?', answer: 'A birthday party', option1: 'A birthday party', option2: 'Dinner', option3: 'A wedding', option4: 'Breakfast', difficulty: 'Easy', know_more: 'Candles on cake = birthday!' },
      // Inference Investigator - Medium
      { game_type: 'inference-investigator', text1: 'The man wore a white coat and had a stethoscope around his neck.', text2: 'What is his job?', answer: 'Doctor', option1: 'Doctor', option2: 'Chef', option3: 'Teacher', option4: 'Pilot', difficulty: 'Medium', know_more: 'Stethoscope = doctor!' },
      { game_type: 'inference-investigator', text1: 'Lisa checked her watch and started running toward the station.', text2: 'What can you infer?', answer: 'She was late for a train', option1: 'She was late for a train', option2: 'She was exercising', option3: 'She was bored', option4: 'She was cold', difficulty: 'Medium', know_more: 'Running to station = late!' },
      { game_type: 'inference-investigator', text1: 'The students put away their books and lined up at the door.', text2: 'What is about to happen?', answer: 'Class is ending', option1: 'Class is ending', option2: 'A test', option3: 'Class is starting', option4: 'They are in trouble', difficulty: 'Medium', know_more: 'Lining up = leaving soon!' },
      { game_type: 'inference-investigator', text1: 'Jake\'s hands were covered in dirt and he was holding a shovel.', text2: 'What was Jake probably doing?', answer: 'Gardening or digging', option1: 'Gardening or digging', option2: 'Reading', option3: 'Cooking', option4: 'Painting', difficulty: 'Medium', know_more: 'Dirt + shovel = digging!' },
      { game_type: 'inference-investigator', text1: 'Everyone in the theater suddenly became quiet and looked at the stage.', text2: 'What is happening?', answer: 'Show is starting', option1: 'Show is starting', option2: 'Fire alarm', option3: 'Intermission', option4: 'Everyone left', difficulty: 'Medium', know_more: 'Quiet = performance starting!' },
      // Inference Investigator - Hard
      { game_type: 'inference-investigator', text1: 'Despite the sunny forecast, Mrs. Chen brought her raincoat. Her joints had been aching all morning.', text2: 'Why did she bring a raincoat?', answer: 'She sensed rain coming from her pain', option1: 'She sensed rain coming from her pain', option2: 'She liked raincoats', option3: 'It was cold', option4: 'She was confused', difficulty: 'Hard', know_more: 'Some people feel weather in joints!' },
      { game_type: 'inference-investigator', text1: 'The detective noticed the calendar was still on March although it was now June.', text2: 'What can you infer?', answer: 'No one has been there since March', option1: 'No one has been there since March', option2: 'They like March', option3: 'Clock is broken', option4: 'They forgot', difficulty: 'Hard', know_more: 'Old calendar = uninhabited!' },
      { game_type: 'inference-investigator', text1: 'The cookies were gone and there were crumbs leading to the dog\'s bed.', text2: 'What happened to the cookies?', answer: 'The dog ate them', option1: 'The dog ate them', option2: 'Mom ate them', option3: 'They disappeared', option4: 'They were never there', difficulty: 'Hard', know_more: 'Crumbs are evidence!' },
      { game_type: 'inference-investigator', text1: 'Alex smiled when she saw the envelope but frowned after reading the letter inside.', text2: 'What can you infer about the letter?', answer: 'It contained bad news', option1: 'It contained bad news', option2: 'It was funny', option3: 'It was blank', option4: 'It was from grandma', difficulty: 'Hard', know_more: 'Reaction changed = unexpected news!' },
      { game_type: 'inference-investigator', text1: 'The plants near the window were green and healthy, but the ones in the corner were yellow and wilting.', text2: 'Why are the corner plants struggling?', answer: 'Not enough light', option1: 'Not enough light', option2: 'Too much water', option3: 'Too cold', option4: 'Wrong soil', difficulty: 'Hard', know_more: 'Window = light, corner = dark!' },

      // The Why Why Girl - Story Nebula
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'Moyna is a curious ten-year-old girl from a tribal village in India. She is called the why-why girl by the postmaster because she asks endless questions about everything around her. Despite her keen intellect, Moyna cannot attend school because she must tend to goats, collect firewood, and fetch water for her family.', answer: 'Why is Moyna called the why-why girl?', option1: 'She asks many questions', option2: 'She cries a lot', option3: 'She runs very fast', option4: 'She sings songs', difficulty: 'Easy', topic: 'The Why Why Girl', subtopic: 'Character Traits', know_more: 'Nicknames often tell us about a persons personality!' },
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'Moyna is a curious ten-year-old girl from a tribal village in India. She is called the why-why girl by the postmaster because she asks endless questions about everything around her. Despite her keen intellect, Moyna cannot attend school because she must tend to goats, collect firewood, and fetch water for her family.', answer: 'What does Moyna do instead of going to school?', option1: 'Tends goats and collects firewood', option2: 'Plays with friends', option3: 'Watches television', option4: 'Sleeps all day', difficulty: 'Easy', topic: 'The Why Why Girl', subtopic: 'Story Details', know_more: 'Many children around the world work to help their families.' },
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'Moyna is a curious ten-year-old girl from a tribal village in India. She is called the why-why girl by the postmaster because she asks endless questions about everything around her. Despite her keen intellect, Moyna cannot attend school because she must tend to goats, collect firewood, and fetch water for her family.', answer: 'How old is Moyna?', option1: 'Ten years old', option2: 'Eight years old', option3: 'Twelve years old', option4: 'Five years old', difficulty: 'Easy', topic: 'The Why Why Girl', subtopic: 'Story Details', know_more: 'Pay attention to numbers and ages when reading!' },
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'The author Mahasweta Devi works closely with tribal communities. When she meets Moyna, she recognizes the girls sharp mind. Instead of dismissing Moynas questions, the author helps her find answers. She introduces Moyna to the world of books, explaining that they hold the solutions to her whys.', answer: 'Who helps Moyna find answers to her questions?', option1: 'The author Mahasweta Devi', option2: 'The postmaster', option3: 'Her mother', option4: 'Her teacher', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Character Relationships', know_more: 'Authors sometimes appear as characters in their own stories!' },
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'The author Mahasweta Devi works closely with tribal communities. When she meets Moyna, she recognizes the girls sharp mind. Instead of dismissing Moynas questions, the author helps her find answers. She introduces Moyna to the world of books, explaining that they hold the solutions to her whys.', answer: 'What does the author say holds the answers to Moynas questions?', option1: 'Books', option2: 'The sky', option3: 'Her grandmother', option4: 'The postmaster', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Main Ideas', know_more: 'Books are wonderful sources of knowledge and answers!' },
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'Through her interactions with the author, Moyna learns to read and eventually finds the answers she seeks. Moynas thirst for knowledge leads her to overcome obstacles. Ultimately, Moyna becomes a teacher in her village, inspiring other children to ask questions and pursue learning.', answer: 'What does Moyna become at the end of the story?', option1: 'A teacher', option2: 'A doctor', option3: 'A farmer', option4: 'A postmaster', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Story Ending', know_more: 'Education can change your life and help you change others lives too!' },
      { game_type: 'story-nebula', text1: 'The Why Why Girl', text2: 'Through her interactions with the author, Moyna learns to read and eventually finds the answers she seeks. Moynas thirst for knowledge leads her to overcome obstacles. Ultimately, Moyna becomes a teacher in her village, inspiring other children to ask questions and pursue learning.', answer: 'What does Moyna inspire other children to do?', option1: 'Ask questions and learn', option2: 'Play games', option3: 'Collect firewood', option4: 'Tend goats', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Theme', know_more: 'Asking questions is the first step to learning!' },

      // The Why Why Girl - Inference Investigator
      { game_type: 'inference-investigator', text1: 'Moyna asked the postmaster why the sky is blue, why birds can fly, and why the river flows. The postmaster just shook his head and walked away.', text2: 'What can you infer about Moynas personality?', answer: 'She is very curious', option1: 'She is very curious', option2: 'She is lazy', option3: 'She is scared', option4: 'She is angry', difficulty: 'Easy', topic: 'The Why Why Girl', subtopic: 'Character Traits', know_more: 'When someone asks many questions it shows they want to learn!' },
      { game_type: 'inference-investigator', text1: 'Despite being very smart, Moyna couldnt go to school. Every morning she woke up early to tend goats, collect firewood, and fetch water.', text2: 'Why couldnt Moyna go to school?', answer: 'She had to work to help her family', option1: 'She had to work to help her family', option2: 'She didnt like school', option3: 'School was too far away', option4: 'She was too young', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Cause and Effect', know_more: 'Some children have responsibilities that prevent them from going to school.' },
      { game_type: 'inference-investigator', text1: 'When the author gave Moyna a book, Moynas eyes lit up. She held the book carefully as if it was made of gold.', text2: 'How did Moyna feel about the book?', answer: 'Excited and grateful', option1: 'Excited and grateful', option2: 'Bored and tired', option3: 'Scared and worried', option4: 'Angry and upset', difficulty: 'Easy', topic: 'The Why Why Girl', subtopic: 'Emotions', know_more: 'Eyes lighting up usually means someone is happy or excited!' },
      { game_type: 'inference-investigator', text1: 'Years later, children in Moynas village could read and write. They asked questions freely and loved to learn.', text2: 'What can you infer about Moynas work as a teacher?', answer: 'She was a good teacher', option1: 'She was a good teacher', option2: 'She was strict and mean', option3: 'She didnt teach well', option4: 'She left the village', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Drawing Conclusions', know_more: 'If students are learning well it usually means they have a good teacher!' },
      { game_type: 'inference-investigator', text1: 'The postmaster dismissed Moynas questions, but the author listened carefully and helped her find answers.', text2: 'How was the author different from the postmaster?', answer: 'The author valued Moynas curiosity', option1: 'The author valued Moynas curiosity', option2: 'The author ignored Moyna', option3: 'The author was scared of questions', option4: 'The author couldnt read', difficulty: 'Hard', topic: 'The Why Why Girl', subtopic: 'Compare and Contrast', know_more: 'Good mentors encourage questions instead of dismissing them.' },
      { game_type: 'inference-investigator', text1: 'Moyna walked five miles every day to fetch water, yet she never stopped asking questions about the world around her.', text2: 'What does this tell us about Moyna?', answer: 'She was determined and curious', option1: 'She was determined and curious', option2: 'She was lazy', option3: 'She gave up easily', option4: 'She didnt like walking', difficulty: 'Medium', topic: 'The Why Why Girl', subtopic: 'Character Traits', know_more: 'Determination means not giving up despite difficulties.' },
    ];

    // ============ DATA FETCHING HOOK WITH FALLBACK ============
    const useSheetData = (url, gameType) => {
      const [data, setData] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        const isMath = ['space-math', 'alien-invasion', 'bubble-pop', 'planet-hopper', 'fraction-frenzy', 'time-warp', 'money-master', 'geometry-galaxy'].includes(gameType);
        const fallbackData = isMath ? FALLBACK_MATH_DATA : FALLBACK_ENGLISH_DATA;

        const loadFallback = () => {
          console.log('Using fallback data for:', gameType);
          const filtered = gameType ? fallbackData.filter(row => row.game_type === gameType) : fallbackData;
          setData(filtered);
          setLoading(false);
          setError(null);
        };

        if (!url) { loadFallback(); return; }

        setLoading(true);
        fetch(url)
          .then(res => {
            if (!res.ok) throw new Error('Network response was not ok');
            return res.text();
          })
          .then(csv => {
            const parsed = parseCSV(csv);
            const filtered = gameType ? parsed.filter(row => row.game_type === gameType) : parsed;
            if (filtered.length > 0) {
              setData(filtered);
            } else {
              // No data for this game type in sheet, use fallback
              loadFallback();
              return;
            }
            setLoading(false);
          })
          .catch(err => {
            console.warn('Fetch failed, using fallback data:', err.message);
            loadFallback();
          });
      }, [url, gameType]);

      return { data, loading, error };
    };


    // ============ SHARED COMPONENTS ============
    const StarIcon = ({ className = "w-5 h-5" }) => (
      <svg className={className} viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
      </svg>
    );

    const DifficultyBadge = ({ difficulty }) => {
      const colors = { Easy: 'bg-green-500', Medium: 'bg-yellow-500', Hard: 'bg-red-500' };
      return <span className={`${colors[difficulty] || 'bg-gray-500'} text-white text-xs px-2 py-1 rounded-full font-bold`}>{difficulty}</span>;
    };

    const LoadingSpinner = () => (
      <div className="flex flex-col items-center justify-center">
        <div className="w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p className="text-white">Loading questions...</p>
      </div>
    );

    const Header = ({ timer, streak, stars, onBack, formatTime, difficulty }) => (
      <div className="absolute top-4 left-4 right-4 flex justify-between items-center z-20" role="banner">
        <div className="flex items-center gap-4">
          <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back" className="w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 transition-colors cursor-pointer">←</button>
          <div className="flex items-center bg-gray-900/80 rounded-lg p-2 backdrop-blur">
            <div>
              <div className="text-xl font-bold text-white">{formatTime(timer)}</div>
              <div className="text-xs text-blue-300">TIMER</div>
            </div>
            <div className="ml-3 border-l border-gray-600 pl-3">
              <div className="text-xl font-bold text-orange-400">{streak}</div>
              <div className="text-xs text-orange-300">STREAK</div>
            </div>
            {difficulty && <div className="ml-3 border-l border-gray-600 pl-3"><DifficultyBadge difficulty={difficulty} /></div>}
          </div>
        </div>
        <div className="flex items-center gap-2">
          <div className="bg-yellow-500 text-white px-3 py-1 rounded-l-full font-bold flex items-center gap-1"><StarIcon className="w-4 h-4" /></div>
          <div className="bg-gray-200 text-gray-800 px-4 py-1 rounded-r-full font-bold min-w-16 text-center">{stars}</div>
        </div>
      </div>
    );

    const GameOverScreen = ({ stars, streak, onRestart, onBack, onSaveScore, playerName, setPlayerName, scoreSaved }) => (
      <div className="text-center bg-gray-900/80 p-8 rounded-2xl backdrop-blur max-w-sm mx-4 relative z-30">
        <h2 className="text-4xl font-bold text-white mb-2">Game Over!</h2>
        <div className="flex items-center justify-center gap-2 mb-4">
          <StarIcon className="w-10 h-10 text-yellow-400" />
          <span className="text-5xl font-bold text-yellow-400">{stars}</span>
        </div>
        <p className="text-purple-300 mb-6">Best Streak: {streak}</p>
        {!scoreSaved && (
          <div className="mb-6">
            <input type="text" placeholder="Enter your name" value={playerName} onChange={(e) => setPlayerName(e.target.value)}
              className="px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none w-full mb-2" maxLength={20} />
            <button onClick={onSaveScore} disabled={!playerName.trim()}
              className="bg-yellow-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-yellow-400 disabled:opacity-50 w-full cursor-pointer">Save Score</button>
          </div>
        )}
        {scoreSaved && <p className="text-green-400 mb-6">✓ Score saved!</p>}
        <div className="flex gap-4 justify-center">
          <button onClick={onBack} className="bg-gray-600 text-white px-6 py-3 rounded-full font-bold hover:bg-gray-500 cursor-pointer">HOME</button>
          <button onClick={onRestart} className="bg-gradient-to-r from-orange-500 to-yellow-500 text-white px-6 py-3 rounded-full font-bold hover:scale-105 transition-transform cursor-pointer">PLAY AGAIN</button>
        </div>
      </div>
    );

    const SpaceBackground = ({ children, variant = 'default' }) => {
      const [bubbles] = useState(() => Array.from({ length: 30 }, (_, i) => ({
        id: i, x: Math.random() * 100, y: Math.random() * 100, size: Math.random() * 3 + 1, duration: Math.random() * 3 + 2
      })));
      const gradients = {
        default: 'linear-gradient(180deg, #1a0a2e 0%, #2d1b4e 50%, #4a2c7a 100%)',
        english: 'linear-gradient(180deg, #0a1628 0%, #1e3a5f 50%, #2d5a87 100%)',
        grammar: 'linear-gradient(180deg, #1a1a2e 0%, #2e1f5e 50%, #4a3c7a 100%)',
        vocabulary: 'linear-gradient(180deg, #1a2a1a 0%, #2e4e2e 50%, #3a6a3a 100%)',
        comprehension: 'linear-gradient(180deg, #0a2020 0%, #1e4a4a 50%, #2d6a6a 100%)',
        math: 'linear-gradient(180deg, #1a0a2e 0%, #2d1b4e 50%, #4a2c7a 100%)'
      };
      return (
        <div className="relative w-full h-screen overflow-hidden" style={{ background: gradients[variant] }}>
          <div className="pointer-events-none absolute inset-0">
            {bubbles.map(bubble => (
              <div key={bubble.id} className="absolute rounded-full bg-white opacity-60"
                style={{ left: `${bubble.x}%`, top: `${bubble.y}%`, width: bubble.size, height: bubble.size, animation: `twinkle ${bubble.duration}s ease-in-out infinite` }} />
            ))}
          </div>
          <div className="relative z-10 h-full">{children}</div>
          <style>{`
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
      `}</style>
        </div>
      );
    };

    const formatTime = (s) => `${Math.floor(s / 60).toString().padStart(2, '0')}:${(s % 60).toString().padStart(2, '0')}`;

    // ============ GENERIC GAME COMPONENT (Sheet-Integrated) ============
    const SheetBasedGame = ({ onBack, difficulty, onGameEnd, settings, gameId, title, icon, color, variant, questionType }) => {
      const isMath = ['space-math', 'alien-invasion', 'bubble-pop', 'planet-hopper', 'fraction-frenzy', 'time-warp', 'money-master', 'geometry-galaxy'].includes(gameId);
      const sheetUrl = isMath ? settings.mathSheetUrl : settings.englishSheetUrl;
      const { data: allQuestions, loading, error } = useSheetData(sheetUrl, gameId);

      const [stars, setStars] = useState(0);
      const [timer, setTimer] = useState(difficulty === 'Hard' ? 30 : difficulty === 'Medium' ? 40 : 50);
      const [gameActive, setGameActive] = useState(false);
      const [gameOver, setGameOver] = useState(false);
      const [currentQ, setCurrentQ] = useState(null);
      const [streak, setStreak] = useState(0);
      const [maxStreak, setMaxStreak] = useState(0);
      const [feedback, setFeedback] = useState(null);
      const [showKnowMore, setShowKnowMore] = useState(false);
      const [playerName, setPlayerName] = useState('');
      const [scoreSaved, setScoreSaved] = useState(false);
      const [shuffledOptions, setShuffledOptions] = useState([]);
      const usedIndicesRef = React.useRef(new Set());

      // Filter questions by difficulty and topics/subtopics
      const questions = allQuestions.filter(q => {
        // Difficulty filter
        if (q.difficulty) {
          const qDiff = q.difficulty.toLowerCase().trim();
          const targetDiff = difficulty.toLowerCase().trim();
          if (qDiff !== targetDiff && targetDiff !== 'all') return false;
        }

        // Topic filter
        if (settings.selectedTopics && settings.selectedTopics.trim()) {
          const allowedTopics = settings.selectedTopics.split(',').map(t => t.trim().toLowerCase());
          const qTopic = (q.topic || '').toLowerCase().trim();
          if (qTopic && !allowedTopics.includes(qTopic) && !allowedTopics.some(t => qTopic.includes(t))) return false;
        }

        // Subtopic filter
        if (settings.selectedSubtopics && settings.selectedSubtopics.trim()) {
          const allowedSubtopics = settings.selectedSubtopics.split(',').map(s => s.trim().toLowerCase());
          const qSubtopic = (q.subtopic || '').toLowerCase().trim();
          if (qSubtopic && !allowedSubtopics.includes(qSubtopic) && !allowedSubtopics.some(s => qSubtopic.includes(s))) return false;
        }

        return true;
      });

      const getNextQuestion = useCallback(() => {
        if (questions.length === 0) return null;
        const currentUsed = usedIndicesRef.current;
        let available = questions.filter((_, i) => !currentUsed.has(i));

        // If all questions used, END THE GAME - don't loop
        if (available.length === 0) {
          return null; // Signal game completion
        }

        const idx = Math.floor(Math.random() * available.length);
        const realIdx = questions.indexOf(available[idx]);
        usedIndicesRef.current.add(realIdx);
        return available[idx];
      }, [questions]);

      const generateQuestion = useCallback(() => {
        const q = getNextQuestion();
        if (q) {
          setCurrentQ(q);
          // Shuffle options once when question is generated (for synonym/antonym games)
          const opts = [q.answer, q.option2, q.option3, q.option4].filter(Boolean);
          const shuffled = [...opts].sort(() => Math.random() - 0.5);
          setShuffledOptions(shuffled);
        } else {
          // All questions completed - show game over
          setGameActive(false);
          setGameOver(true);
        }
      }, [getNextQuestion]);

      useEffect(() => {
        if (gameActive && timer > 0 && !showKnowMore) {
          const interval = setInterval(() => setTimer(t => t - 1), 1000);
          return () => clearInterval(interval);
        } else if (timer === 0 && gameActive) {
          setGameActive(false);
          setGameOver(true);
        }
      }, [gameActive, timer, showKnowMore]);

      const startGame = () => {
        setStars(0);
        setTimer(difficulty === 'Hard' ? 30 : difficulty === 'Medium' ? 40 : 50);
        setStreak(0);
        setMaxStreak(0);
        usedIndicesRef.current = new Set();
        setGameActive(true);
        setGameOver(false);
        setScoreSaved(false);
        setPlayerName('');
        setShowKnowMore(false);
        generateQuestion();
      };

      const handleAnswer = (selected, correct) => {
        if (!gameActive || feedback || showKnowMore) return;
        const isCorrect = selected === correct;
        if (isCorrect) {
          const mult = difficulty === 'Hard' ? 2 : difficulty === 'Medium' ? 1.5 : 1;
          setStars(s => s + Math.floor((15 + streak * 3) * mult));
          setStreak(s => { const n = s + 1; setMaxStreak(m => Math.max(m, n)); return n; });
          setFeedback({ correct: true });
        } else {
          setStreak(0);
          setFeedback({ correct: false, answer: correct });
        }
        // Show Know More section after brief feedback delay
        setTimeout(() => { setShowKnowMore(true); }, 500);
      };

      const handleNext = () => {
        setFeedback(null);
        setShowKnowMore(false);
        generateQuestion();
      };

      const handleSaveScore = async () => {
        if (!playerName.trim()) return;
        await onGameEnd(gameId, playerName, stars, maxStreak);
        setScoreSaved(true);
      };

      // Render question based on game type
      const renderQuestion = () => {
        if (!currentQ) return <p className="text-white">No questions available</p>;

        // Math equations (space-math, alien-invasion, bubble-pop)
        if (['space-math', 'alien-invasion', 'bubble-pop'].includes(gameId)) {
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-white text-4xl font-bold mb-2">
                  {currentQ.num1} {currentQ.operation} {currentQ.num2} = ?
                </div>
                {currentQ.hint && <p className="text-gray-400 text-sm">{currentQ.hint}</p>}
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-2xl font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : `bg-gradient-to-r ${color} text-white hover:scale-105`
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Sequences (planet-hopper)
        if (gameId === 'planet-hopper') {
          // New format: num1 = "2 4 6 ? 10", answer = "8"
          const seqParts = currentQ.num1 ? currentQ.num1.split(' ') : [];
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-lg">
              <div className="flex justify-center gap-2 mb-6 flex-wrap">
                {seqParts.map((part, i) => (
                  <div key={i} className={`w-14 h-14 rounded-full flex items-center justify-center text-lg font-bold text-white shadow-lg border-4 border-white/30 ${part === '?' ? 'bg-gray-600' : 'bg-gradient-to-b from-purple-400 to-purple-600'
                    }`} style={{ animation: 'float 3s ease-in-out infinite' }}>
                    {part}
                  </div>
                ))}
              </div>
              <p className="text-white text-center mb-4">Find the missing number!</p>
              {currentQ.hint && <p className="text-gray-400 text-sm text-center mb-4">{currentQ.hint}</p>}
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-xl font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Grammar
        if (gameId === 'grammar-galaxy') {
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6">
                <div className="text-xs text-purple-400 mb-2">{currentQ.text2}</div>
                <div className="text-white text-2xl font-medium text-center">"{currentQ.text1}"</div>
              </div>
              <p className="text-purple-200 text-center mb-4">Choose the correct word:</p>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-lg font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Word class
        if (gameId === 'word-class-warp') {
          const categories = ['noun', 'verb', 'adjective', 'adverb'];
          const icons = { noun: '📦', verb: '🏃', adjective: '🎨', adverb: '⚡' };
          const colors_map = { noun: 'from-red-500 to-orange-500', verb: 'from-green-500 to-emerald-500', adjective: 'from-blue-500 to-purple-500', adverb: 'from-yellow-500 to-amber-500' };
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-8 backdrop-blur mb-8 text-center">
                <div className="text-4xl font-bold text-white" style={{ animation: 'float 2s ease-in-out infinite' }}>{currentQ.text1}</div>
              </div>
              <div className="grid grid-cols-2 gap-4 relative z-20">
                {categories.map(cat => (
                  <button key={cat} onClick={() => handleAnswer(cat, currentQ.answer)}
                    className={`p-6 rounded-2xl text-white font-bold text-lg transition-all hover:scale-105 cursor-pointer bg-gradient-to-br ${colors_map[cat]} ${feedback && cat === currentQ.answer ? 'ring-4 ring-green-400' : ''
                      }`}>
                    <div className="text-3xl mb-2">{icons[cat]}</div>
                    {cat.charAt(0).toUpperCase() + cat.slice(1)}
                  </button>
                ))}
              </div>
            </div>
          );
        }

        // Punctuation
        if (gameId === 'punctuation-pop') {
          const marks = ['.', '?', '!', ','];
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6">
                <div className="text-white text-2xl font-medium text-center">
                  {currentQ.text1}<span className="text-yellow-400 text-3xl animate-pulse">_</span>
                </div>
              </div>
              <div className="flex justify-center gap-4 relative z-20">
                {marks.map(mark => (
                  <button key={mark} onClick={() => handleAnswer(mark, currentQ.answer)}
                    className={`w-16 h-16 rounded-full text-3xl font-bold transition-all hover:scale-110 cursor-pointer ${feedback && mark === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gradient-to-b from-pink-400 to-rose-500 text-white'
                      }`}>{mark}</button>
                ))}
              </div>
            </div>
          );
        }

        // Tenses
        if (gameId === 'tense-traveler') {
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          const tenseColors = { past: 'from-amber-600 to-orange-700', present: 'from-green-500 to-emerald-600', future: 'from-blue-500 to-indigo-600' };
          const tenseIcons = { past: '⏪', present: '▶️', future: '⏩' };
          return (
            <div className="w-full max-w-lg">
              <div className={`bg-gradient-to-r ${tenseColors[currentQ.text2] || 'from-gray-500 to-gray-600'} rounded-2xl p-4 mb-4 text-center`}>
                <div className="text-3xl mb-1">{tenseIcons[currentQ.text2] || '🕐'}</div>
                <div className="text-white text-xl font-bold">{(currentQ.text2 || 'TENSE').toUpperCase()}</div>
              </div>
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-gray-400 text-sm mb-2">Convert this verb:</div>
                <div className="text-white text-4xl font-bold">{currentQ.text1}</div>
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-lg font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-teal-600 to-emerald-600 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Synonyms & Antonyms
        if (gameId === 'synonym-stars' || gameId === 'antonym-asteroids') {
          // Use pre-shuffled options from state to prevent re-shuffle on hover
          const options = shuffledOptions.length > 0 ? shuffledOptions : [currentQ.answer, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          const isSynonym = gameId === 'synonym-stars';
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-green-300 text-sm mb-2">Find {isSynonym ? 'a word that means the same as' : 'the OPPOSITE of'}:</div>
                <div className="text-white text-4xl font-bold">{currentQ.text1}</div>
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-lg font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : `bg-gradient-to-r ${isSynonym ? 'from-yellow-500 to-orange-500' : 'from-red-500 to-orange-500'} text-white hover:scale-105`
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Story comprehension
        if (gameId === 'story-nebula') {
          // New format: text1=title, text2=story, answer=question, option1=correct answer
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-2xl">
              <div className="bg-gray-900/80 rounded-2xl p-4 backdrop-blur mb-4 max-h-40 overflow-y-auto">
                <h3 className="text-yellow-400 font-bold mb-2">📖 {currentQ.text1}</h3>
                <p className="text-white text-sm leading-relaxed">{currentQ.text2}</p>
              </div>
              <div className="bg-teal-900/60 rounded-2xl p-4 mb-4">
                <div className="text-white text-lg font-medium">❓ {currentQ.answer}</div>
              </div>
              <div className="grid grid-cols-1 gap-2 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.option1)}
                    className={`p-3 rounded-xl text-left font-medium transition-all cursor-pointer ${feedback ? (opt === currentQ.option1 ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-teal-600 text-white hover:bg-teal-500'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Inference
        if (gameId === 'inference-investigator') {
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-4">
                <div className="text-3xl mb-3 text-center">🔍</div>
                <div className="text-white text-lg leading-relaxed text-center italic">"{currentQ.text1}"</div>
              </div>
              <div className="bg-violet-900/60 rounded-2xl p-4 mb-4">
                <div className="text-white text-lg font-medium text-center">{currentQ.text2}</div>
              </div>
              <div className="grid grid-cols-1 gap-2 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-3 rounded-xl text-left font-medium transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-violet-600 text-white hover:bg-violet-500'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Fractions
        if (gameId === 'fraction-frenzy') {
          // New format: num1 = text description, num2 = operation type, answer = correct answer
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-yellow-400 text-sm mb-2 capitalize">{currentQ.num2}</div>
                <div className="text-white text-2xl font-bold mb-4">{currentQ.num1}</div>
                {currentQ.hint && <p className="text-gray-400 text-sm">{currentQ.hint}</p>}
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-2xl font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-amber-500 to-orange-500 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Time
        if (gameId === 'time-warp') {
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          const hour = parseInt(currentQ.num1) || 3;
          const minute = parseInt(currentQ.num2) || 0;
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-blue-400 text-sm mb-2">{currentQ.operation === 'read' ? 'Read the Clock' : 'Calculate Duration'}</div>
                {currentQ.operation === 'read' && (
                  <svg viewBox="0 0 100 100" className="w-32 h-32 mx-auto">
                    <circle cx="50" cy="50" r="45" fill="#1f2937" stroke="#fbbf24" strokeWidth="3" />
                    {[...Array(12)].map((_, i) => {
                      const angle = (i * 30 - 90) * Math.PI / 180;
                      return <text key={i} x={50 + 35 * Math.cos(angle)} y={50 + 35 * Math.sin(angle) + 4} fill="white" fontSize="10" textAnchor="middle">{i === 0 ? 12 : i}</text>;
                    })}
                    <line x1="50" y1="50" x2={50 + 20 * Math.cos(((hour % 12) * 30 + minute * 0.5 - 90) * Math.PI / 180)} y2={50 + 20 * Math.sin(((hour % 12) * 30 + minute * 0.5 - 90) * Math.PI / 180)} stroke="#ef4444" strokeWidth="4" strokeLinecap="round" />
                    <line x1="50" y1="50" x2={50 + 30 * Math.cos((minute * 6 - 90) * Math.PI / 180)} y2={50 + 30 * Math.sin((minute * 6 - 90) * Math.PI / 180)} stroke="#3b82f6" strokeWidth="3" strokeLinecap="round" />
                  </svg>
                )}
                {currentQ.operation === 'duration' && <div className="text-white text-xl">From {currentQ.num1} to {currentQ.num2}</div>}
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-lg font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Money
        if (gameId === 'money-master') {
          // New format: num1 = text description like "2 quarters + 1 dime", num2 = operation type, answer = correct value
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          const isChange = currentQ.num2 === 'change';
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-green-400 text-sm mb-2">{isChange ? '💵 Make Change' : '🪙 Count the Coins'}</div>
                <div className="text-white text-2xl font-bold mb-4">{currentQ.num1}</div>
                {currentQ.hint && <p className="text-gray-400 text-sm">{currentQ.hint}</p>}
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-2xl font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Geometry
        if (gameId === 'geometry-galaxy') {
          const options = [currentQ.option1, currentQ.option2, currentQ.option3, currentQ.option4].filter(Boolean);
          return (
            <div className="w-full max-w-lg">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur mb-6 text-center">
                <div className="text-pink-400 text-sm mb-2">{currentQ.operation}</div>
                {currentQ.operation === 'identify' && <div className="text-8xl mb-4">{currentQ.text1 === 'triangle' ? '△' : currentQ.text1 === 'square' ? '□' : currentQ.text1 === 'circle' ? '○' : currentQ.text1 === 'rectangle' ? '▭' : currentQ.text1 === 'pentagon' ? '⬠' : '⬡'}</div>}
                {currentQ.operation === 'sides' && <div className="text-white text-2xl mb-4">How many sides does a {currentQ.text1} have?</div>}
                {(currentQ.operation === 'perimeter' || currentQ.operation === 'area') && (
                  <>
                    <div className="text-white text-xl mb-4">{currentQ.operation === 'perimeter' ? 'Perimeter' : 'Area'} of square with side {currentQ.num1}?</div>
                    <div className="w-20 h-20 bg-pink-500/30 border-4 border-pink-400 mx-auto flex items-center justify-center text-white text-lg font-bold">{currentQ.num1}</div>
                  </>
                )}
              </div>
              <div className="grid grid-cols-2 gap-3 relative z-20">
                {options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt, currentQ.answer)}
                    className={`p-4 rounded-xl text-lg font-bold transition-all cursor-pointer ${feedback ? (opt === currentQ.answer ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-400')
                      : 'bg-gradient-to-r from-pink-500 to-purple-500 text-white hover:scale-105'
                      }`}>{opt}</button>
                ))}
              </div>
            </div>
          );
        }

        // Default fallback
        return <p className="text-white">Question type not supported</p>;
      };

      if (loading) return <SpaceBackground variant={variant}><div className="flex items-center justify-center h-full"><LoadingSpinner /></div></SpaceBackground>;
      if (error) return <SpaceBackground variant={variant}><div className="flex flex-col items-center justify-center h-full"><p className="text-red-400 mb-4">Error: {error}</p><button onClick={onBack} className="bg-gray-600 text-white px-6 py-3 rounded-full cursor-pointer">Back</button></div></SpaceBackground>;

      return (
        <SpaceBackground variant={variant}>
          <Header timer={timer} streak={streak} stars={stars} onBack={onBack} formatTime={formatTime} difficulty={difficulty} />
          <div className="flex flex-col items-center justify-center h-full pt-20 px-4">
            {!gameActive && !gameOver && (
              <div className="text-center">
                <h1 className="text-5xl font-bold text-white mb-2">{icon} {title}</h1>
                <DifficultyBadge difficulty={difficulty} />
                <p className="text-gray-300 my-4">{questions.length} questions ready</p>
                <button onClick={startGame} disabled={questions.length === 0}
                  className={`bg-gradient-to-r ${color} text-white px-8 py-4 rounded-full text-xl font-bold hover:scale-105 transition-transform shadow-lg cursor-pointer disabled:opacity-50`}>
                  {questions.length > 0 ? 'START GAME' : 'No Questions Available'}
                </button>
              </div>
            )}
            {gameOver && <GameOverScreen stars={stars} streak={maxStreak} onRestart={startGame} onBack={onBack} onSaveScore={handleSaveScore} playerName={playerName} setPlayerName={setPlayerName} scoreSaved={scoreSaved} />}
            {gameActive && renderQuestion()}
            {feedback && <div className={`mt-4 text-center text-xl font-bold ${feedback.correct ? 'text-green-400' : 'text-red-400'}`}>{feedback.correct ? '✓ Correct!' : `✗ Answer: ${feedback.answer}`}</div>}
            {showKnowMore && (
              <div className="mt-4 text-center max-w-lg mx-auto">
                {currentQ?.know_more && (
                  <div className="bg-gradient-to-r from-blue-600/80 to-purple-600/80 rounded-xl p-4 mb-4 backdrop-blur">
                    <div className="text-yellow-300 text-sm font-bold mb-1">💡 Did You Know?</div>
                    <p className="text-white text-sm">{currentQ.know_more}</p>
                  </div>
                )}
                <button onClick={handleNext} className="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-8 py-3 rounded-full text-lg font-bold hover:scale-105 transition-transform shadow-lg cursor-pointer">
                  NEXT →
                </button>
              </div>
            )}
          </div>
        </SpaceBackground>
      );
    };

    // ============ GAME CONFIGS ============
    const MATH_GAMES = [
      { id: 'space-math', title: 'Space Math', icon: '🚀', color: 'from-orange-500 to-yellow-500', difficulty: 'Easy', description: 'Solve equations!' },
      { id: 'alien-invasion', title: 'Alien Invasion', icon: '👾', color: 'from-green-500 to-cyan-500', difficulty: 'Hard', description: 'Zap aliens!' },
      { id: 'bubble-pop', title: 'Bubble Pop', icon: '🫧', color: 'from-cyan-500 to-blue-500', difficulty: 'Easy', description: 'Pop answers!' },
      { id: 'planet-hopper', title: 'Planet Hopper', icon: '🪐', color: 'from-purple-500 to-pink-500', difficulty: 'Medium', description: 'Complete sequences!' },
      { id: 'fraction-frenzy', title: 'Fraction Frenzy', icon: '🍕', color: 'from-amber-500 to-orange-500', difficulty: 'Medium', description: 'Master fractions!' },
      { id: 'time-warp', title: 'Time Warp', icon: '⏰', color: 'from-blue-500 to-indigo-500', difficulty: 'Easy', description: 'Tell time!' },
      { id: 'money-master', title: 'Money Master', icon: '💰', color: 'from-green-500 to-emerald-500', difficulty: 'Medium', description: 'Count money!' },
      { id: 'geometry-galaxy', title: 'Geometry Galaxy', icon: '📐', color: 'from-pink-500 to-purple-500', difficulty: 'Medium', description: 'Learn shapes!' },
    ];

    const GRAMMAR_GAMES = [
      { id: 'grammar-galaxy', title: 'Grammar Galaxy', icon: '🛸', color: 'from-purple-500 to-indigo-500', difficulty: 'Medium', description: 'Fix grammar!' },
      { id: 'word-class-warp', title: 'Word Class Warp', icon: '🌟', color: 'from-pink-500 to-purple-500', difficulty: 'Easy', description: 'Sort words!' },
      { id: 'punctuation-pop', title: 'Punctuation Pop', icon: '✨', color: 'from-pink-500 to-rose-500', difficulty: 'Easy', description: 'Add punctuation!' },
      { id: 'tense-traveler', title: 'Tense Traveler', icon: '⏰', color: 'from-emerald-500 to-teal-500', difficulty: 'Medium', description: 'Verb tenses!' },
    ];

    const VOCABULARY_GAMES = [
      { id: 'synonym-stars', title: 'Synonym Stars', icon: '⭐', color: 'from-yellow-500 to-orange-500', difficulty: 'Easy', description: 'Find synonyms!' },
      { id: 'antonym-asteroids', title: 'Antonym Asteroids', icon: '☄️', color: 'from-red-500 to-orange-500', difficulty: 'Easy', description: 'Find opposites!' },
    ];

    const COMPREHENSION_GAMES = [
      { id: 'story-nebula', title: 'Story Nebula', icon: '📖', color: 'from-indigo-500 to-purple-500', difficulty: 'Medium', description: 'Read stories!' },
      { id: 'inference-investigator', title: 'Inference Investigator', icon: '🔍', color: 'from-violet-500 to-purple-500', difficulty: 'Hard', description: 'Make inferences!' },
    ];

    const ALL_GAMES = [...MATH_GAMES, ...GRAMMAR_GAMES, ...VOCABULARY_GAMES, ...COMPREHENSION_GAMES];

    // ============ SETTINGS PAGE ============
    const SettingsPage = ({ settings, setSettings, onBack }) => {
      const [localSettings, setLocalSettings] = useState(settings);
      const [urlErrors, setUrlErrors] = useState({ math: '', english: '' });
      const [password, setPassword] = useState('');
      const [isUnlocked, setIsUnlocked] = useState(false);
      const [error, setError] = useState('');

      const SETTINGS_PASSWORD = 'Superdad';

      const handleUnlock = () => {
        if (password === SETTINGS_PASSWORD) {
          setIsUnlocked(true);
          setError('');
        } else {
          setError('Incorrect password');
          setPassword('');
        }
      };

      const validateGoogleSheetUrl = (url) => {
        if (!url || !url.trim()) return 'URL is required';

        // Check if it's a valid Google Sheets published CSV URL
        const googleSheetsPattern = /^https:\/\/docs\.google\.com\/spreadsheets\/d\/(e\/)?[\w-]+\/pub\?output=csv/;

        if (!googleSheetsPattern.test(url)) {
          return 'Invalid Google Sheets URL. Must be a published CSV link (File → Share → Publish to web → CSV)';
        }

        return '';
      };

      const handleMathUrlChange = (url) => {
        setLocalSettings({ ...localSettings, mathSheetUrl: url });
        setUrlErrors({ ...urlErrors, math: validateGoogleSheetUrl(url) });
      };

      const handleEnglishUrlChange = (url) => {
        setLocalSettings({ ...localSettings, englishSheetUrl: url });
        setUrlErrors({ ...urlErrors, english: validateGoogleSheetUrl(url) });
      };

      const handleSave = async () => {
        setSettings(localSettings);
        try { await storage.set('learning-galaxy-settings', JSON.stringify(localSettings)); } catch (e) { }

        // Save to Google Sheet if URL is provided
        if (localSettings.settingsSheetUrl && localSettings.settingsSheetUrl.trim()) {
          try {
            const settingsData = {
              timestamp: new Date().toISOString(),
              mathSheetUrl: localSettings.mathSheetUrl,
              englishSheetUrl: localSettings.englishSheetUrl,
              defaultDifficulty: localSettings.defaultDifficulty,
              soundEnabled: localSettings.soundEnabled,
              leaderboardUrl: localSettings.leaderboardUrl || '',
              settingsSheetUrl: localSettings.settingsSheetUrl || ''
            };

            await fetch(localSettings.settingsSheetUrl, {
              method: 'POST',
              mode: 'no-cors',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(settingsData)
            });
            console.log('Settings saved to Google Sheet');
          } catch (e) {
            console.error('Failed to save settings to Google Sheet:', e);
          }
        }

        onBack();
      };

      const handleReset = () => {
        setLocalSettings(DEFAULT_SETTINGS);
        setUrlErrors({ math: '', english: '' });
      };

      const isValid = !validateGoogleSheetUrl(localSettings.mathSheetUrl) && !validateGoogleSheetUrl(localSettings.englishSheetUrl);

      if (!isUnlocked) {
        return (
          <SpaceBackground>
            <div className="flex flex-col items-center justify-center h-full px-4">
              <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
              <div className="text-6xl mb-4">🔒</div>
              <h1 className="text-3xl font-bold text-white mb-2">Settings Locked</h1>
              <p className="text-purple-300 mb-6 text-sm">Enter password to access settings</p>
              <div className="w-full max-w-xs relative z-20">
                <input
                  type="password"
                  placeholder="Enter password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && handleUnlock()}
                  className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none mb-3"
                />
                {error && <p className="text-red-400 text-sm mb-3 text-center">{error}</p>}
                <button onClick={handleUnlock} className="w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white px-6 py-3 rounded-full font-bold hover:scale-105 transition-transform cursor-pointer">
                  Unlock
                </button>
              </div>
            </div>
          </SpaceBackground>
        );
      }

      return (
        <SpaceBackground>
          <div className="flex flex-col items-center h-full px-4 py-8 overflow-y-auto">
            <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
            <h1 className="text-4xl font-bold text-white mb-8 pt-8">⚙️ Settings</h1>
            <div className="w-full max-w-lg space-y-6 relative z-20">
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                <h2 className="text-xl font-bold text-white mb-4">🔢 Math Questions Sheet</h2>
                <textarea value={localSettings.mathSheetUrl} onChange={(e) => setLocalSettings({ ...localSettings, mathSheetUrl: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none text-xs font-mono resize-none" rows={3} />
              </div>
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                <h2 className="text-xl font-bold text-white mb-4">📚 English Questions Sheet</h2>
                <textarea value={localSettings.englishSheetUrl} onChange={(e) => setLocalSettings({ ...localSettings, englishSheetUrl: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none text-xs font-mono resize-none" rows={3} />
              </div>
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                <h2 className="text-xl font-bold text-white mb-4">🎯 Default Difficulty</h2>
                <p className="text-gray-400 text-sm mb-4">Choose "None" to let kids pick difficulty each game</p>
                <select value={localSettings.defaultDifficulty} onChange={(e) => setLocalSettings({ ...localSettings, defaultDifficulty: e.target.value })}
                  className="w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 cursor-pointer">
                  <option value="None">None (Choose per game)</option>
                  <option value="Easy">Easy</option>
                  <option value="Medium">Medium</option>
                  <option value="Hard">Hard</option>
                </select>
                <p className="text-gray-400 text-xs mt-2">When "None" is selected, you can choose difficulty before each game. Otherwise, only the selected difficulty will be available.</p>
              </div>
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                <h2 className="text-xl font-bold text-white mb-4">📊 Leaderboard Integration</h2>
                <p className="text-gray-400 text-sm mb-4">Paste Google Apps Script Web App URL to save scores online</p>
                <input type="text" placeholder="https://script.google.com/macros/s/..." value={localSettings.leaderboardUrl || ''} onChange={(e) => setLocalSettings({ ...localSettings, leaderboardUrl: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none" />
              </div>
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                <h2 className="text-xl font-bold text-white mb-4">⚙️ Settings Backup to Google Sheet</h2>
                <p className="text-gray-400 text-sm mb-4">Paste Google Apps Script Web App URL to save settings to Google Sheets</p>
                <input type="text" placeholder="https://script.google.com/macros/s/..." value={localSettings.settingsSheetUrl || ''} onChange={(e) => setLocalSettings({ ...localSettings, settingsSheetUrl: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none" />
                <p className="text-gray-400 text-xs mt-2">💡 When configured, all settings changes will be saved to your Google Sheet</p>
              </div>
              <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                <h2 className="text-xl font-bold text-white mb-4">📝 Topics & Subtopics</h2>
                <p className="text-gray-400 text-sm mb-4">Filter questions by topic. Link to a Google Sheet containing topics or enter them manually.</p>
                <div className="mb-4">
                  <label className="text-white text-sm font-medium block mb-2">Topics Sheet URL (optional)</label>
                  <input type="text" placeholder="https://docs.google.com/spreadsheets/d/.../pub?output=csv" value={localSettings.topicSheetUrl || ''} onChange={(e) => setLocalSettings({ ...localSettings, topicSheetUrl: e.target.value })}
                    className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none text-xs font-mono" />
                </div>
                <div className="mb-4">
                  <label className="text-white text-sm font-medium block mb-2">Topics (comma-separated)</label>
                  <input type="text" placeholder="e.g., Addition, Subtraction, Fractions" value={localSettings.selectedTopics || ''} onChange={(e) => setLocalSettings({ ...localSettings, selectedTopics: e.target.value })}
                    className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none" />
                  <p className="text-gray-400 text-xs mt-1">Leave empty to show all topics</p>
                </div>
                <div>
                  <label className="text-white text-sm font-medium block mb-2">Subtopics (comma-separated)</label>
                  <input type="text" placeholder="e.g., Single Digit, Double Digit, Word Problems" value={localSettings.selectedSubtopics || ''} onChange={(e) => setLocalSettings({ ...localSettings, selectedSubtopics: e.target.value })}
                    className="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none" />
                  <p className="text-gray-400 text-xs mt-1">Leave empty to show all subtopics</p>
                </div>
              </div>
              <div className="flex gap-3">
                <button onClick={handleReset} aria-label="Reset settings to defaults" className="flex-1 bg-gray-600 text-white px-6 py-4 rounded-full text-lg font-bold hover:bg-gray-500 transition-colors cursor-pointer">🔄 Reset</button>
                <button onClick={handleSave} disabled={!isValid} aria-label="Save settings"
                  className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-4 rounded-full text-lg font-bold hover:scale-105 transition-transform shadow-lg cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                  💾 Save Settings
                </button>
              </div>
            </div>
          </div>
        </SpaceBackground>
      );
    };

    // ============ NAVIGATION COMPONENTS ============
    const DifficultySelector = ({ game, onSelect, onBack, settings }) => {
      const gameInfo = ALL_GAMES.find(g => g.id === game);
      const lockedDifficulty = settings?.defaultDifficulty && settings.defaultDifficulty !== 'None' ? settings.defaultDifficulty : null;

      return (
        <SpaceBackground variant="math">
          <div className="flex flex-col items-center justify-center h-full px-4">
            <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back to game selection" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
            <div className="text-6xl mb-4">{gameInfo?.icon}</div>
            <h1 className="text-4xl font-bold text-white mb-4">{gameInfo?.title}</h1>
            {lockedDifficulty && <p className="text-purple-300 mb-4 text-sm">Difficulty locked to {lockedDifficulty} in settings</p>}
            <div className="flex flex-col gap-4 w-full max-w-xs relative z-20">
              {['Easy', 'Medium', 'Hard'].map(diff => {
                const isDisabled = lockedDifficulty && lockedDifficulty !== diff;
                return (
                  <button
                    key={diff}
                    onClick={() => !isDisabled && onSelect(diff)}
                    disabled={isDisabled}
                    className={`p-4 rounded-2xl text-left transition-all cursor-pointer ${isDisabled ? 'opacity-30 cursor-not-allowed' : 'hover:scale-105'} ${diff === 'Easy' ? 'bg-gradient-to-r from-green-500 to-green-600' : diff === 'Medium' ? 'bg-gradient-to-r from-yellow-500 to-orange-500' : 'bg-gradient-to-r from-red-500 to-red-600'}`}
                  >
                    <div className="text-xl font-bold text-white">{diff}</div>
                  </button>
                );
              })}
            </div>
          </div>
        </SpaceBackground>
      );
    };

    const GameTilesPage = ({ title, icon, games, onSelectGame, onBack, totalStars, variant }) => (
      <SpaceBackground variant={variant}>
        <div className="flex flex-col items-center h-full px-4 py-8 overflow-y-auto">
          <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back to previous screen" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
          <div className="text-center mb-8 pt-8">
            <h1 className="text-4xl font-bold text-white mb-2">{icon} {title}</h1>
            <div className="flex items-center justify-center gap-2 mt-4 bg-gray-900/60 px-4 py-2 rounded-full" aria-live="polite">
              <StarIcon className="w-5 h-5 text-yellow-400" aria-hidden="true" />
              <span className="text-yellow-400 font-bold">{totalStars} Stars</span>
            </div>
          </div>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-4xl w-full pb-8 relative z-20">
            {games.map((game, i) => (
              <button key={game.id} onClick={() => onSelectGame(game.id)}
                className={`bg-gradient-to-br ${game.color} p-4 rounded-2xl shadow-xl text-left transition-all hover:scale-105 cursor-pointer`}
                style={{ animation: `slideIn 0.3s ease-out ${i * 0.05}s both` }}>
                <div className="text-3xl mb-2">{game.icon}</div>
                <h3 className="text-sm font-bold text-white mb-1">{game.title}</h3>
                <p className="text-white/80 text-xs">{game.description}</p>
              </button>
            ))}
          </div>
        </div>
      </SpaceBackground>
    );

    const EnglishLandingPage = ({ onSelectCategory, onBack, totalStars }) => (
      <SpaceBackground variant="english">
        <div className="flex flex-col items-center justify-center h-full px-4">
          <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back to home" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
          <h1 className="text-5xl font-bold text-white mb-8">📚 English Galaxy</h1>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl w-full relative z-20" role="navigation" aria-label="English categories">
            {[
              { id: 'grammar', icon: '✏️', title: 'Grammar', color: 'from-purple-600 to-indigo-700', count: GRAMMAR_GAMES.length },
              { id: 'vocabulary', icon: '📖', title: 'Vocabulary', color: 'from-green-600 to-emerald-700', count: VOCABULARY_GAMES.length },
              { id: 'comprehension', icon: '🔍', title: 'Comprehension', color: 'from-teal-600 to-cyan-700', count: COMPREHENSION_GAMES.length },
            ].map(cat => (
              <button key={cat.id} onClick={() => onSelectCategory(cat.id)} className={`bg-gradient-to-br ${cat.color} p-6 rounded-3xl shadow-2xl hover:scale-105 transition-all text-left cursor-pointer`}>
                <div className="text-5xl mb-3">{cat.icon}</div>
                <h2 className="text-2xl font-bold text-white mb-1">{cat.title}</h2>
                <p className="text-white/70 text-sm">{cat.count} games</p>
              </button>
            ))}
          </div>
        </div>
      </SpaceBackground>
    );

    const MainLandingPage = ({ onSelectSubject, totalStars, onOpenLeaderboard, onOpenQA, onOpenSettings, leaderboard = [] }) => {
      // Time-based greeting
      const getGreeting = () => {
        const hour = new Date().getHours();
        if (hour < 12) return { text: 'Good Morning', emoji: '🌅' };
        if (hour < 17) return { text: 'Good Afternoon', emoji: '☀️' };
        return { text: 'Good Evening', emoji: '🌙' };
      };
      const greeting = getGreeting();

      // Calculate achievements
      const totalGames = leaderboard.length;
      const bestStreak = leaderboard.reduce((max, g) => Math.max(max, g.streak || 0), 0);

      // Floating elements for fun animation
      const floatingItems = ['🚀', '⭐', '🌍', '🛸', '💫', '🌟'];

      return (
        <SpaceBackground>
          {/* Settings button - top right */}
          <button onClick={onOpenSettings} className="absolute top-4 right-4 w-12 h-12 rounded-full bg-gray-900/80 flex items-center justify-center text-2xl hover:bg-gray-700 z-30 cursor-pointer transition-all hover:scale-110">
            ⚙️
          </button>

          {/* Floating decorations */}
          <div className="absolute inset-0 overflow-hidden pointer-events-none z-0">
            {floatingItems.map((item, i) => (
              <div key={i} className="absolute text-4xl opacity-40"
                style={{
                  left: `${10 + i * 15}%`,
                  top: `${20 + (i % 3) * 25}%`,
                  animation: `float ${3 + i * 0.5}s ease-in-out infinite`,
                  animationDelay: `${i * 0.3}s`
                }}>
                {item}
              </div>
            ))}
          </div>

          <div className="flex flex-col items-center justify-center min-h-full px-4 py-6 relative z-10">
            {/* Mascot and Greeting */}
            <div className="text-center mb-4">
              <div className="text-7xl mb-2" style={{ animation: 'float 2s ease-in-out infinite' }}>🤖</div>
              <p className="text-lg text-purple-200">{greeting.emoji} {greeting.text}, Explorer!</p>
            </div>

            {/* Title */}
            <h1 className="text-4xl sm:text-5xl md:text-6xl font-bold mb-2 text-center">
              <span className="bg-gradient-to-r from-yellow-300 via-pink-400 to-purple-500 bg-clip-text text-transparent drop-shadow-lg">
                Learning Galaxy
              </span>
            </h1>
            <p className="text-sm sm:text-base text-purple-300 mb-4">Fun learning for Grade 3-4! 🎮</p>

            {/* Stats Cards - Mobile friendly row */}
            <div className="flex flex-wrap justify-center gap-2 sm:gap-3 mb-6 relative z-20">
              <div className="flex items-center gap-2 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border border-yellow-500/50 px-3 py-2 rounded-full">
                <span className="text-xl">⭐</span>
                <span className="text-yellow-300 font-bold text-sm sm:text-base">{totalStars}</span>
              </div>
              <div className="flex items-center gap-2 bg-gradient-to-r from-green-500/20 to-emerald-500/20 border border-green-500/50 px-3 py-2 rounded-full">
                <span className="text-xl">🎮</span>
                <span className="text-green-300 font-bold text-sm sm:text-base">{totalGames} played</span>
              </div>
              <div className="flex items-center gap-2 bg-gradient-to-r from-orange-500/20 to-red-500/20 border border-orange-500/50 px-3 py-2 rounded-full">
                <span className="text-xl">🔥</span>
                <span className="text-orange-300 font-bold text-sm sm:text-base">{bestStreak} streak</span>
              </div>
            </div>

            {/* Subject Cards - Responsive grid */}
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md sm:max-w-2xl relative z-20 mb-6">
              <button onClick={() => onSelectSubject('math')}
                className="bg-gradient-to-br from-purple-500 via-purple-600 to-indigo-700 p-6 sm:p-8 rounded-3xl shadow-2xl hover:scale-105 transition-all text-left cursor-pointer border-2 border-purple-400/30 group">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="text-5xl sm:text-6xl mb-2 group-hover:scale-110 transition-transform">🔢</div>
                    <h2 className="text-2xl sm:text-3xl font-bold text-white mb-1">Math</h2>
                    <p className="text-purple-200 text-sm">{MATH_GAMES.length} fun games!</p>
                  </div>
                  <div className="text-4xl opacity-50 group-hover:opacity-100 transition-opacity">→</div>
                </div>
              </button>
              <button onClick={() => onSelectSubject('english')}
                className="bg-gradient-to-br from-blue-500 via-blue-600 to-cyan-700 p-6 sm:p-8 rounded-3xl shadow-2xl hover:scale-105 transition-all text-left cursor-pointer border-2 border-blue-400/30 group">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="text-5xl sm:text-6xl mb-2 group-hover:scale-110 transition-transform">📚</div>
                    <h2 className="text-2xl sm:text-3xl font-bold text-white mb-1">English</h2>
                    <p className="text-blue-200 text-sm">{GRAMMAR_GAMES.length + VOCABULARY_GAMES.length + COMPREHENSION_GAMES.length} fun games!</p>
                  </div>
                  <div className="text-4xl opacity-50 group-hover:opacity-100 transition-opacity">→</div>
                </div>
              </button>
            </div>

            {/* Action Buttons */}
            <div className="flex flex-col sm:flex-row gap-3 relative z-20">
              <button onClick={onOpenLeaderboard}
                className="flex items-center gap-3 bg-gradient-to-r from-amber-500 to-yellow-500 px-6 py-3 rounded-full font-bold text-white hover:scale-105 transition-all shadow-lg cursor-pointer">
                <span className="text-2xl">🏆</span>
                <span>View Leaderboard</span>
              </button>
              <button onClick={onOpenQA}
                className="flex items-center gap-3 bg-gradient-to-r from-cyan-500 to-blue-500 px-6 py-3 rounded-full font-bold text-white hover:scale-105 transition-all shadow-lg cursor-pointer">
                <span className="text-2xl">📊</span>
                <span>QA Analytics</span>
              </button>
            </div>
          </div>
        </SpaceBackground>
      );
    };

    const Leaderboard = ({ onBack, leaderboard }) => {
      const [filter, setFilter] = useState('all');
      const filtered = filter === 'all' ? leaderboard : leaderboard.filter(s => filter === 'math' ? MATH_GAMES.find(g => g.id === s.game) : !MATH_GAMES.find(g => g.id === s.game));
      const sorted = [...filtered].sort((a, b) => b.stars - a.stars).slice(0, 10);

      return (
        <SpaceBackground>
          <div className="flex flex-col items-center h-full pt-8 px-4 overflow-y-auto">
            <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back to home" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
            <h1 className="text-4xl font-bold text-white mb-6">🏆 Leaderboard</h1>
            <div className="flex gap-2 mb-6 relative z-20" role="tablist" aria-label="Filter by subject">
              {['all', 'math', 'english'].map(f => (
                <button key={f} onClick={() => setFilter(f)} role="tab" aria-selected={filter === f} aria-label={`Filter by ${f}`} className={`px-4 py-2 rounded-full font-bold capitalize cursor-pointer ${filter === f ? 'bg-yellow-500 text-white' : 'bg-gray-700 text-gray-300'}`}>{f}</button>
              ))}
            </div>
            <div className="w-full max-w-md bg-gray-900/80 rounded-2xl p-4 backdrop-blur relative z-20">
              {sorted.length === 0 ? <p className="text-center text-gray-400 py-8">No scores yet!</p> : (
                <div className="space-y-2">
                  {sorted.map((score, i) => {
                    const gameInfo = ALL_GAMES.find(g => g.id === score.game);
                    return (
                      <div key={i} className={`flex items-center gap-3 p-3 rounded-lg ${i === 0 ? 'bg-yellow-500/20' : 'bg-gray-800/50'}`}>
                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${i === 0 ? 'bg-yellow-500 text-black' : 'bg-gray-700 text-white'}`}>{i + 1}</div>
                        <div className="flex-1"><div className="text-white font-bold">{score.name}</div><div className="text-gray-400 text-xs">{gameInfo?.title}</div></div>
                        <div className="flex items-center gap-1 text-yellow-400 font-bold"><StarIcon className="w-4 h-4" />{score.stars}</div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        </SpaceBackground>
      );
    };

    // ============ QA ANALYTICS PAGE ============
    const QAPage = ({ onBack, leaderboard }) => {
      // Calculate analytics
      const totalGames = leaderboard.length;
      const totalStars = leaderboard.reduce((sum, s) => sum + s.stars, 0);
      const avgStars = totalGames > 0 ? Math.round(totalStars / totalGames) : 0;
      const bestStreak = leaderboard.reduce((max, s) => Math.max(max, s.streak || 0), 0);

      // Games played breakdown
      const mathGames = leaderboard.filter(s => MATH_GAMES.find(g => g.id === s.game)).length;
      const englishGames = leaderboard.filter(s => !MATH_GAMES.find(g => g.id === s.game)).length;

      // Most played game
      const gameCount = {};
      leaderboard.forEach(s => {
        gameCount[s.game] = (gameCount[s.game] || 0) + 1;
      });
      const mostPlayedGameId = Object.keys(gameCount).reduce((a, b) => gameCount[a] > gameCount[b] ? a : b, '');
      const mostPlayedGame = ALL_GAMES.find(g => g.id === mostPlayedGameId);

      // Top performers
      const topPerformers = [...leaderboard]
        .sort((a, b) => b.stars - a.stars)
        .slice(0, 5)
        .reduce((acc, curr) => {
          if (!acc.find(p => p.name === curr.name)) {
            acc.push(curr);
          }
          return acc;
        }, []);

      // Recent activity (last 10 games)
      const recentGames = [...leaderboard]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 10);

      return (
        <SpaceBackground variant="default">
          <div className="flex flex-col items-center h-full pt-8 px-4 overflow-y-auto pb-8">
            <button onClick={onBack} onKeyDown={(e) => e.key === 'Enter' && onBack()} aria-label="Go back to home" className="absolute top-4 left-4 w-10 h-10 rounded-full bg-gray-900/80 flex items-center justify-center text-white hover:bg-gray-700 z-20 cursor-pointer">←</button>
            <h1 className="text-4xl font-bold text-white mb-6">📊 QA Analytics</h1>

            {totalGames === 0 ? (
              <div className="bg-gray-900/80 rounded-2xl p-8 backdrop-blur text-center">
                <div className="text-6xl mb-4">📈</div>
                <p className="text-gray-400">No data yet! Play some games to see analytics.</p>
              </div>
            ) : (
              <div className="w-full max-w-4xl space-y-6 relative z-20">
                {/* Summary Stats */}
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div className="bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl p-4 text-center">
                    <div className="text-3xl font-bold text-white">{totalGames}</div>
                    <div className="text-purple-200 text-sm">Total Games</div>
                  </div>
                  <div className="bg-gradient-to-br from-yellow-500 to-orange-500 rounded-2xl p-4 text-center">
                    <div className="text-3xl font-bold text-white">{totalStars}</div>
                    <div className="text-yellow-100 text-sm">Total Stars</div>
                  </div>
                  <div className="bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl p-4 text-center">
                    <div className="text-3xl font-bold text-white">{avgStars}</div>
                    <div className="text-green-100 text-sm">Avg Stars</div>
                  </div>
                  <div className="bg-gradient-to-br from-red-500 to-orange-600 rounded-2xl p-4 text-center">
                    <div className="text-3xl font-bold text-white">{bestStreak}</div>
                    <div className="text-red-100 text-sm">Best Streak</div>
                  </div>
                </div>

                {/* Subject Breakdown */}
                <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                  <h2 className="text-2xl font-bold text-white mb-4">📚 Subject Breakdown</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div className="bg-purple-500/20 rounded-xl p-4 border border-purple-500/50">
                      <div className="text-4xl mb-2">🔢</div>
                      <div className="text-2xl font-bold text-white">{mathGames}</div>
                      <div className="text-purple-200 text-sm">Math Games</div>
                    </div>
                    <div className="bg-blue-500/20 rounded-xl p-4 border border-blue-500/50">
                      <div className="text-4xl mb-2">📚</div>
                      <div className="text-2xl font-bold text-white">{englishGames}</div>
                      <div className="text-blue-200 text-sm">English Games</div>
                    </div>
                  </div>
                </div>

                {/* Most Played Game */}
                {mostPlayedGame && (
                  <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                    <h2 className="text-2xl font-bold text-white mb-4">🎮 Most Played Game</h2>
                    <div className={`bg-gradient-to-br ${mostPlayedGame.color} rounded-xl p-6`}>
                      <div className="flex items-center gap-4">
                        <div className="text-5xl">{mostPlayedGame.icon}</div>
                        <div>
                          <div className="text-2xl font-bold text-white">{mostPlayedGame.title}</div>
                          <div className="text-white/80 text-sm">Played {gameCount[mostPlayedGameId]} times</div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Top Performers */}
                {topPerformers.length > 0 && (
                  <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                    <h2 className="text-2xl font-bold text-white mb-4">🌟 Top Performers</h2>
                    <div className="space-y-2">
                      {topPerformers.map((player, i) => {
                        const gameInfo = ALL_GAMES.find(g => g.id === player.game);
                        return (
                          <div key={i} className={`flex items-center gap-3 p-3 rounded-lg ${i === 0 ? 'bg-yellow-500/20 border border-yellow-500/50' : 'bg-gray-800/50'}`}>
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${i === 0 ? 'bg-yellow-500 text-black' : 'bg-gray-700 text-white'}`}>
                              {i + 1}
                            </div>
                            <div className="flex-1">
                              <div className="text-white font-bold">{player.name}</div>
                              <div className="text-gray-400 text-xs">{gameInfo?.title}</div>
                            </div>
                            <div className="text-right">
                              <div className="flex items-center gap-1 text-yellow-400 font-bold">
                                <StarIcon className="w-4 h-4" />{player.stars}
                              </div>
                              <div className="text-orange-400 text-xs">🔥 {player.streak} streak</div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* Recent Activity */}
                <div className="bg-gray-900/80 rounded-2xl p-6 backdrop-blur">
                  <h2 className="text-2xl font-bold text-white mb-4">⏱️ Recent Activity</h2>
                  <div className="space-y-2">
                    {recentGames.map((game, i) => {
                      const gameInfo = ALL_GAMES.find(g => g.id === game.game);
                      const timeAgo = new Date(game.date).toLocaleDateString();
                      return (
                        <div key={i} className="flex items-center gap-3 p-3 rounded-lg bg-gray-800/50">
                          <div className="text-2xl">{gameInfo?.icon || '🎮'}</div>
                          <div className="flex-1">
                            <div className="text-white font-medium">{game.name}</div>
                            <div className="text-gray-400 text-xs">{gameInfo?.title} • {timeAgo}</div>
                          </div>
                          <div className="flex items-center gap-1 text-yellow-400 font-bold">
                            <StarIcon className="w-4 h-4" />{game.stars}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            )}
          </div>
        </SpaceBackground>
      );
    };

    // ============ MAIN APP ============
    const LearningGalaxy = () => {
      const [currentSubject, setCurrentSubject] = useState(null);
      const [englishCategory, setEnglishCategory] = useState(null);
      const [currentGame, setCurrentGame] = useState(null);
      const [selectedDifficulty, setSelectedDifficulty] = useState(null);
      const [showLeaderboard, setShowLeaderboard] = useState(false);
      const [showQA, setShowQA] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      const [leaderboard, setLeaderboard] = useState([]);
      const [settings, setSettings] = useState(DEFAULT_SETTINGS);

      useEffect(() => {
        const loadData = async () => {
          try {
            const lb = await storage.get('learning-galaxy-leaderboard');
            if (lb?.value) setLeaderboard(JSON.parse(lb.value));
            const st = await storage.get('learning-galaxy-settings');
            if (st?.value) setSettings(JSON.parse(st.value));
          } catch (e) { }
        };
        loadData();
      }, []);

      const handleGameEnd = async (game, name, stars, streak) => {
        const updated = [...leaderboard, { game, name, stars, streak, date: new Date().toISOString() }];
        setLeaderboard(updated);
        try { await storage.set('learning-galaxy-leaderboard', JSON.stringify(updated)); } catch (e) { }
      };

      const totalStars = leaderboard.reduce((sum, e) => sum + e.stars, 0);
      const handleBackToHome = () => { setCurrentSubject(null); setEnglishCategory(null); setCurrentGame(null); setSelectedDifficulty(null); };

      if (showSettings) return <SettingsPage settings={settings} setSettings={setSettings} onBack={() => setShowSettings(false)} />;
      if (showLeaderboard) return <Leaderboard onBack={() => setShowLeaderboard(false)} leaderboard={leaderboard} />;
      if (showQA) return <QAPage onBack={() => setShowQA(false)} leaderboard={leaderboard} />;

      if (currentGame && selectedDifficulty) {
        const gameInfo = ALL_GAMES.find(g => g.id === currentGame);
        const variant = MATH_GAMES.find(g => g.id === currentGame) ? 'math' : GRAMMAR_GAMES.find(g => g.id === currentGame) ? 'grammar' : VOCABULARY_GAMES.find(g => g.id === currentGame) ? 'vocabulary' : 'comprehension';
        return <SheetBasedGame onBack={handleBackToHome} difficulty={selectedDifficulty} onGameEnd={handleGameEnd} settings={settings} gameId={currentGame} title={gameInfo?.title} icon={gameInfo?.icon} color={gameInfo?.color} variant={variant} />;
      }

      if (currentGame) return <DifficultySelector game={currentGame} onSelect={setSelectedDifficulty} onBack={() => setCurrentGame(null)} settings={settings} />;
      const handleGameSelect = (gameId) => {
        setCurrentGame(gameId);
        if (settings.defaultDifficulty && settings.defaultDifficulty !== 'None') {
          setSelectedDifficulty(settings.defaultDifficulty);
        }
      };

      if (currentSubject === 'english' && englishCategory) {
        const games = englishCategory === 'grammar' ? GRAMMAR_GAMES : englishCategory === 'vocabulary' ? VOCABULARY_GAMES : COMPREHENSION_GAMES;
        return <GameTilesPage title={englishCategory.charAt(0).toUpperCase() + englishCategory.slice(1)} icon={englishCategory === 'grammar' ? '✏️' : englishCategory === 'vocabulary' ? '📖' : '🔍'} games={games} onSelectGame={handleGameSelect} onBack={() => setEnglishCategory(null)} totalStars={totalStars} variant={englishCategory} />;
      }
      if (currentSubject === 'english') return <EnglishLandingPage onSelectCategory={setEnglishCategory} onBack={handleBackToHome} totalStars={totalStars} />;
      if (currentSubject === 'math') return <GameTilesPage title="Math Galaxy" icon="🔢" games={MATH_GAMES} onSelectGame={handleGameSelect} onBack={handleBackToHome} totalStars={totalStars} variant="math" />;

      return <MainLandingPage onSelectSubject={setCurrentSubject} totalStars={totalStars} onOpenLeaderboard={() => setShowLeaderboard(true)} onOpenQA={() => setShowQA(true)} onOpenSettings={() => setShowSettings(true)} leaderboard={leaderboard} />;
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<LearningGalaxy />);

  </script>
</body>

</html>